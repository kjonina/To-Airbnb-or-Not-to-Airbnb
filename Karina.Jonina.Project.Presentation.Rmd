---
title: "AirBnB: Cause of Housing Crisis in Dublin?"
author: "KarinaJonina"
date: "05/01/2022"
output:
  slidy_presentation:     
    theme: sandstone
    highlight: tango
  powerpoint_presentation: default

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Student Information
- Student Name:   Karina Jonina
- Student Code:   c00278440
- Module Title:   Data Visualisation and Insight
- Module Code:    DATAC5202
- Module Leader:  Agnes Maciocha
- Course Name:    Master of Science in Data Science
- Course Code:    CW_KCDAR_M
- Due Date:       5th January 2022

```{r echo=FALSE,  warning=FALSE, message=FALSE}
#installing necessary package
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("dplyr")) install.packages("dplyr")
if (!require("stringr")) install.packages("stringr")
if (!require("knitr")) install.packages("stringr")
if (!require("plotly")) install.packages("plotly")
if (!require("forcats")) install.packages("forcats")
if (!require("crosstalk")) install.packages("crosstalk")

library(ggplot2)
library(dplyr)
library(stringr)
library(knitr)
library(plotly)
library(forcats)
library(crosstalk)

# reading the csv
df =  read.csv('listings.csv')
```



# Introduction
**Aim**  
- Tell a story about AirBnB listings through graphs in 'plotly' and 'dplyr' packages in R.

**Housing Crisis** 

- Defined as a shortage of affordable accommodation for renting or buying 

**AirBnB** 

- Leading short-term lease of a private property website, where individuals place their homes on AirBnB to lease it to tourists on a short-term basis

**Research Quesion**

- How does AirBnB impact on the Irish House Crisis?

# CSVs Used

| # | csv | Description  |
|:-:|:-|:-|
| 1 | listings.csv | AirBnB listings in Ireland from the beginning of AirBnB operating in Ireland | 
| 2 | homeless_September_2021.csv | Homeless Report published every month by the Irish government captures statistics about homelessness (Department of Housing, Local Government and Heritage, 2021). | 
| 3 | rent_pressure_zones.csv | Rent Pressure Zones (RPZs) are areas located in parts of the country where rents are the highest and rising, and where households have the greatest difficulty finding affordable accommodation (Residential Tenancies Board, 2021). | 
| 4 | rent_in_ireland.csv | The website daft.ie publishes reports on the Irish housing market every quarter. The report Q2 2021 was used to find out the rent in each city and county in Ireland (Lyons, 2021). | 
| 5| calendar.csv | AirBnB listings from 23rd October 2021 to 21st October 2021 (dates not chosen by student, supplied by AirBnB), contains 9 million rows. | 

**New Dataset made from calendar.csv**

| # | csv | Description  |
|:-:|:-|:-|
| 6 | summarise_df.csv | A new dataset from calendar.csv  was created, where listings were examined by availability for each month within a year (23rd October 2021 to 21st October 2022). | 
| 7 | available_nights_df.csv | A new dataset summarising the number of available nights for each listing in a year (23rd October 2021 to 21st October 2022). | 

```{r echo=FALSE}
# reading the csv
df =  read.csv('listings.csv')

# reading the csv
summarise_df =  read.csv('summarise_df.csv')

# reading the csv
available_nights_df =  read.csv('available_nights_df.csv')

# reading the csv
rent_df =  read.csv('rent_in_ireland.csv')

# reading the csv
homelessness_df =  read.csv('homeless_September_2021.csv')
```

# Business Understanding
**Housing Crisis**

- Defined as a shortage of affordable accommodation for renting or buying 
- Irish government attempts  reduce the housing crisis with plans of affordable and social housing
- Adults of all ages worry about not being able to afford a home because of rent prices and increasing house prices

**AirBnB**

- Criticised for the increase of listings for short-term leasing for tourism
- Reported that over 30,000 Irish listings on the site in Ireland for short-term lease (Pope, 2021)
- Nearly half of those listings are rooms in private homes and over 10,000 entire homes are available all-year-round
- Planning permission: for listing in Rent Pressure Zones (RPZs) if entire rental unit is leased for short-term lets of more than 90 days in total (Citizensinformation.ie, no date).

**Research Question**

1.	What is the impact of AirBnB on Irish Housing Crisis? 
2.	Can moving entire rental units and private rooms from AirBnB listings take the pressure of the Irish Housing Crisis?


# Data Preparation
- Dropping 
  - outliers in price
  - past AirBnB Listings,no longer available between 23rd October 2021 and 21st October 2021.
  - 'Hotel room' from dataset because hotel rooms are not contributing to the Housing Crisis.
- Creating new variables: 
  - Term: short-term and long-term lease
  - Threshold: under-90 and over-90 days lease
  - Planning permission: Required and Not Required
  - Student Accommodation: True or False


```{r echo=FALSE, warning=FALSE, message=FALSE}
# changing 'month' to factor
summarise_df$mmonth <- as.factor(summarise_df$month)

# changing  the order of factors
summarise_df$month <- factor(summarise_df$month, levels = c("January", "February", "March","April", "May", "June","July", "August", "September","October", "November", "December"))

###########################################################################
# assigning factor to host_id
df$host_id <- as.factor(df$host_id)

# assigning factor to id
df$id <- as.factor(df$id)

###########################################################################
# dropping column 'license' because it is empty
df<- df %>% 
  # keep all columns except 'license'
  select(-license)

###########################################################################
# Availability
# Dataset 'df' was merged with 'available_nights_df' using 'listing_id' in 'available_nights_df' and 'id' in 'df'. 

# merging the dataset together, merging on listings ID in each dataset. 
df <- merge(df, available_nights_df, by.x = "id", by.y = "listing_id")

###########################################################################
# Minimum Nights
# filtering out max outlier
df <-  df %>% 
  # dropping row where minimum_nights is  1125
  filter(!(minimum_nights > 365))

###########################################################################
# Price
# filtering out max outlier
df <-  df %>% 
  # dropping row where price is  1173721 or 0 
  filter(!(price == 1173721 | price == 0))

###########################################################################
# Room Type
# personal preference 
df$room_type <- str_replace(df$room_type, 'Entire home/apt', 'Entire rental unit')

# removing hotel
df <-  df %>% 
  filter(!(room_type == 'Hotel room'))

# declaring column as a factor
df$room_type <- as.factor(df$room_type)

###########################################################################
# Neighbourhood (renamed to 'lea')
# Neighboourhood has some unclean data and 'LEA' was dropped from the values in the column. 
# declaring column as a factor
df$neighbourhood <- as.factor(df$neighbourhood)
df$neighbourhood_group <- as.factor(df$neighbourhood_group)

# getting rid of LEA from the neighbourhood
df$neighbourhood <- str_replace(df$neighbourhood, '-7', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-6', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-5', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-4', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-3', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-3', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-lea-7', ' LEA')
df$neighbourhood <- str_replace(df$neighbourhood, '-LEA', ' LEA')

# neighbourhood column is really 'lea'
df <- rename(df, lea=neighbourhood)

# some values were still incorrect so they were manually changed
df$lea <- str_replace_all(df$lea, c('Graiguecullen -Portarlington LEA ' = 'Graiguecullen-Portarlington LEA',
                                    'Cavan - Belturbet LEA' = 'Cavan-Belturbet LEA',
                                    'Bandon - Kinsale LEA' ='Bandon-Kinsale LEA',
                                    'Bailieborough - Cootehill LEA' = 'Bailieborough-Cootehill LEA',
                                    'Laytown  Bettystown-lea' = 'Laytown-Bettystown LEA',
                                    'DÃºn Laoghaire LEA' = 'Dún Laoghaire-Rathdown County Council'))
# declaring column as a factor
df$lea <- as.factor(df$lea)

# Neighbourhood Group (renamed to 'council')
# renaming neighbourhood_group to council because this is more accurate name
df<- rename(df, council = neighbourhood_group)

# declaring column as a factor
df$council <- as.factor(df$council)

# some values were still incorrect so they were manually changed
df$council <- str_replace(df$council, 'Dun Laoghaire-rathdown County Council', 'Dún Laoghaire-Rathdown County Council')

###########################################################################
# County
# getting rid of County Council from the council to assign county
df$county <- str_replace(df$council, ' County Council', '')
df$county <- str_replace(df$county, ' City Council', '')
df$county <- str_replace(df$county, ' City And', '')

# neighbourhood group in Dublin
df$county <- str_replace(df$county, 'Dún Laoghaire-Rathdown', 'Dublin')
df$county <- str_replace(df$county, 'Fingal', 'Dublin')
df$county <- str_replace(df$county, 'South Dublin', 'Dublin')

# assigning factor to country
df$county <- as.factor(df$county)

###########################################################################
# New Variable: Student Accomondation
# Creating a new variable which detects whether 'Student' is included in the name 

df <- df %>%  
  select(everything()) %>% 
  mutate(
    student_accomodation = case_when(
      str_detect(name, "Student") ~ TRUE,
      str_detect(name, "student") ~ TRUE, 
      str_detect(name, "STUDENT") ~ TRUE, 
      str_detect(name, "Students") ~ TRUE,
      str_detect(name, "students") ~ TRUE, 
      str_detect(name, "STUDENTS") ~ TRUE, 
      TRUE ~ FALSE))


# assigning factor to student_accomodation
df$student_accomodation <- as.factor(df$student_accomodation)

###########################################################################

###########################################################################
# New Variable: Lease
# A new variable 'term' was created to state whether the listing is 'short-term lease' or 'long-term lease'.

df <- df %>%  
  select(everything()) %>%
  mutate(term = if_else(minimum_nights <= 14, 'short-term lease', 'long-term lease'))

# assigning factor to term
df$term <- as.factor(df$term)

###########################################################################
# New Variable: 90-Day Threshold
# A new variable 'threshold_day_90' was created to state whether the listing is 'under-90' or 'over-90' days. 
df <- df %>%  
  mutate(threshold_day_90 = if_else(availability_365 < 90, 'under-90', 'over-90'))

# assigning factor to threshold_day_90
df$threshold_day_90 <- as.factor(df$threshold_day_90)

###########################################################################
# New Variable: Total Income
#Creating a new variable 'total_income', examining the full income potential of a listings by multiplying the price by the number of nights it is available for. 
df <- df %>%  
  select(everything()) %>%
  mutate(total_income = price*availability_365)

# dropping potential total_income over 200,000
df <-  df %>% 
  filter(total_income < 200000)

###########################################################################
# Merging Datasets: 'df' with 'rent_df'
# Datasets 'df' and 'rent_df' were merged on column 'county_city'.
# getting rid of County Council from the 'council' to assign county_city
df$county_city <- str_replace(df$council, ' LEA', '')
df$county_city <- str_replace(df$county_city, ' Council', '')
df$county_city <- str_replace(df$county_city, ' City And', '')

# changing 'council' in Dublin
df$county_city <- str_replace(df$county_city, 'Dun Laoghaire-rathdown', 'Dublin')
df$county_city <- str_replace(df$county_city, 'Fingal', 'Dublin')
df$county_city <- str_replace(df$county_city, 'South Dublin', 'Dublin')

# creating a new variable 'county_city' from 'county' to match 'county_city' in 'rent_df'  
# replacing strings 
df$county_city <- str_replace_all(df$county_city, c('Carlow County' = 'County Carlow',
                                                    'Dublin County' = 'Dublin City',
                                          'Galway County' = 'County Galway',
                                          'Cork County' = 'County Cork',
                                          'Waterford County' = 'County Waterford',
                                          'Offaly County' = 'County Offaly', 
                                          'Wicklow County' = 'County Wicklow', 
                                          'Tipperary County' = 'County Tipperary', 
                                          'Monaghan County' = 'County Monaghan', 
                                          'Sligo County' = 'County Sligo', 
                                          'Wexford County' = 'County Wexford', 
                                          'Clare County' = 'County Clare', 
                                          'Donegal County' = 'County Donegal', 
                                          'Meath County' = 'County Meath', 
                                          'Westmeath County' = 'County Westmeath', 
                                          'Mayo County' = 'County Mayo', 
                                          'Kildare County' = 'County Kildare',
                                          'Kerry County'= 'County Kerry',
                                          'Louth County' = 'County Louth',
                                          'Longford County' = 'County Longford',
                                          'Leitrim County' = 'County Leitrim',
                                          'Kilkenny County'= 'County Kilkenny',
                                          'Laois County'= 'County Laois',
                                          'Roscommon County'= 'County Roscommon',
                                          'Limerick County' = 'County Limerick',
                                          'Cavan County' = 'County Cavan'))



# assigning factor to county_city  variable
df$county_city <- as.factor(df$county_city)

# merging the dataset together
df<- merge(df, rent_df, by.x = "county_city", by.y = "county_city")

###########################################################################
# Merging Datasets: 'df' with 'homeless_county'
# Datasets 'df' and 'homeless_df' were merged on column 'homeless_county'.
# creating a new variable 'homeless_county' from 'county' to match 'county_city' in 'homeless_df' 
# replacing strings 
df$homeless_county <- str_replace(df$county, 'Galway', 'Galway (Galway City and County councils)')
df$homeless_county <- str_replace(df$homeless_county, 'Cork', 'Cork (Cork City and County councils)')
df$homeless_county <- str_replace(df$homeless_county, 'Donegal' , '3') 
df$homeless_county <- str_replace(df$homeless_county, 'Leitrim', '3')
df$homeless_county <- str_replace(df$homeless_county, 'Monaghan' , '1') 
df$homeless_county <- str_replace(df$homeless_county, 'Louth' , '1') 
df$homeless_county <- str_replace(df$homeless_county, 'Cavan', '1')
df$homeless_county <- str_replace(df$homeless_county, 'Mayo', '2')
df$homeless_county <- str_replace(df$homeless_county, 'Roscommon', '2')

df$homeless_county <- str_replace(df$homeless_county, '2', 'Mayo/Roscommon')
df$homeless_county <- str_replace(df$homeless_county, '1', 'Louth/Monaghan/Cavan')
df$homeless_county <- str_replace(df$homeless_county, '3', 'Donegal/Leitrim')

# assigning factor to homeless_county  variable
df$homeless_county <- as.factor(df$homeless_county)

# renaming the weird column name 'ï..homeless_county' with 'homeless_county'
homelessness_df <- rename(homelessness_df, homeless_county= ï..homeless_county)

# merging the dataset together
df<- merge(df, homelessness_df, by.x = "homeless_county", by.y = "homeless_county")

###########################################################################
# New Variable: Rent Per Day
# if the property is 'Entire rental unit'. then multiply rent_price_per_month by 12 (months) and divide by 365 (days)
# otherwise ('Private room' or 'Shared room') multiply rent_price_per_month by 12 (months), divide by 365 (days) and divide by 3 (rooms in the house)
df <- df %>%  
  mutate(rent_price_per_day = if_else(room_type == 'Entire rental unit', (rent_price_per_month*12)/365, ((rent_price_per_month*12)/365)/3))

# if the property is 'Entire rental unit'. then multiply rent_price_per_month by 12 (months) 
# otherwise ('Private room' or 'Shared room') multiply rent_price_per_month by 12 (months) and divide by 3 (rooms in the house)
df <- df %>%  
  mutate(rent_price_per_year = if_else(room_type == 'Entire rental unit', rent_price_per_month*12, (rent_price_per_month*12)/3))
###########################################################################
# New Variable: Rent or AirBnB?
# creating a new variable to state whether the property should be rented or on AirBnB
df <- df %>%  
  mutate(per_day_rent_AirBnB = if_else(price >= rent_price_per_day, 'AirBnB', 'Rent'))

# assigning factor to per_day_rent_AirBnB
df$per_day_rent_AirBnB <- as.factor(df$per_day_rent_AirBnB)

###########################################################################
# creating a new variable to state whether the property should be rented or on AirBnB
df <- df %>%  
  select(everything()) %>%
  mutate(per_year_rent_AirBnB = if_else(total_income <= rent_price_per_year, 'AirBnB', 'Rent'))

# assigning factor to per_year_rent_AirBnB
df$per_year_rent_AirBnB <- as.factor(df$per_year_rent_AirBnB)

###########################################################################
# New Variable: Rent Pressure Zone
# Creating a new variable 
# Manually assessing whether it is TRUE or FALSE
# the list was taken from 'neighbourhood' in 'rpz_df' dataset
df <- df %>%  
  mutate(
    rent_pressure_zone = case_when(
      str_detect(council, 'Cork City Council') ~ TRUE,
      str_detect(council, 'Dublin City Council') ~ TRUE,
      str_detect(council, 'Dún Laoghaire-Rathdown County Council') ~ TRUE,
      str_detect(council, 'Fingal County Council') ~ TRUE,
      str_detect(council, 'South Dublin County Council') ~ TRUE,
      str_detect(council, 'Kildare County Council') ~ TRUE,
      str_detect(lea, 'Ballincollig–Carrigaline LEA') ~ TRUE,
      str_detect(lea, 'Galway City Central LEA') ~ TRUE,
      str_detect(lea, 'Galway City West LEA') ~ TRUE,
      str_detect(lea, 'Galway City East LEA') ~ TRUE,
      str_detect(lea, 'Drogheda LEA') ~ TRUE,
      str_detect(lea, 'Drogheda Urban LEA') ~ TRUE,
      str_detect(lea, 'Drogheda Rural LEA') ~ TRUE,
      str_detect(lea, 'Celbridge-Leixlip LEA') ~ TRUE,
      str_detect(lea, 'Naas LEA') ~ TRUE,
      str_detect(lea, 'Newbridge LEA') ~ TRUE,
      str_detect(lea, 'Ashbourne LEA') ~ TRUE,
      str_detect(lea, 'Laytown-Bettystown LEA') ~ TRUE,
      str_detect(lea, 'Ratoath LEA') ~ TRUE,
      str_detect(lea, 'Bray West LEA') ~ TRUE,
      str_detect(lea, 'Bray East LEA') ~ TRUE,
      str_detect(lea, 'Wicklow LEA') ~ TRUE,
      str_detect(lea, 'Cobh LEA') ~ TRUE,
      str_detect(lea, 'Maynooth LEA') ~ TRUE,
      str_detect(lea, 'Drogheda LEA') ~ TRUE,
      str_detect(lea, 'Greystones LEA') ~ TRUE,
      str_detect(lea, 'Limerick City East LEA') ~ TRUE,
      str_detect(lea, 'Navan LEA') ~ TRUE,
      str_detect(lea, 'Fermoy LEA') ~ TRUE,
      str_detect(lea, 'Midleton LEA') ~ TRUE,
      str_detect(lea, 'Athenry-Oranmore LEA') ~ TRUE,
      str_detect(lea, 'Gort-Kinvara LEA') ~ TRUE,
      str_detect(lea, 'Kilkenny LEA') ~ TRUE,
      str_detect(lea, 'Graiguecullen-Portarlington LEA') ~ TRUE,
      str_detect(lea, 'Portlaoise LEA') ~ TRUE,
      str_detect(lea, 'Limerick City North LEA') ~ TRUE,
      str_detect(lea, 'Limerick City West LEA') ~ TRUE,
      str_detect(lea, 'Ardee LEA') ~ TRUE,
      str_detect(lea, 'Dundalk-Carlingford LEA') ~ TRUE,
      str_detect(lea, 'Dundalk South LEA') ~ TRUE,
      str_detect(lea, 'Kells LEA') ~ TRUE,
      str_detect(lea, 'Trim LEA') ~ TRUE,
      str_detect(lea, 'Waterford City East LEA') ~ TRUE,
      str_detect(lea, 'Waterford City South LEA') ~ TRUE,
      str_detect(lea, 'Athlone LEA') ~ TRUE,
      str_detect(lea, 'Gorey LEA') ~ TRUE,
      str_detect(lea, 'Arklow LEA') ~ TRUE,
      str_detect(lea, 'Carlow LEA') ~ TRUE,
      str_detect(lea, 'Macroom LEA') ~ TRUE,
      str_detect(lea, 'Cobh LEA') ~ TRUE,
      str_detect(lea, 'Piltown LEA') ~ TRUE,
      str_detect(lea, 'Sligo-Strandhill LEA') ~ TRUE,
      str_detect(lea, 'Baltinglass LEA') ~ TRUE,
      str_detect(lea, 'Mallow LEA') ~ TRUE,
      str_detect(lea, 'Killarney LEA') ~ TRUE,
      str_detect(lea, 'Athy LEA') ~ TRUE,
      str_detect(lea, 'Tullamore LEA') ~ TRUE,
      str_detect(lea, 'Mullingar LEA') ~ TRUE,
      str_detect(lea, 'Bandon-Kinsale LEA') ~ TRUE,
      TRUE ~ FALSE)) 


# changing TRUE to 'RPZ' (Rent Pressure Zone) 
df$rent_pressure_zone <- str_replace(df$rent_pressure_zone, 'TRUE', 'RPZ')

# changing False to 'Non-RPZ' (Non Rent Pressure Zone) 
df$rent_pressure_zone <- str_replace(df$rent_pressure_zone, 'FALSE', 'Non-RPZ')

# assigning factor to rent_pressure_zone  variable
df$rent_pressure_zone <- as.factor(df$rent_pressure_zone)

###########################################################################
#New Variable: Planning Permission
df <- df %>%  
  mutate(planning_permission = if_else((room_type == 'Entire rental unit' & threshold_day_90 == 'over-90' & rent_pressure_zone =='RPZ'), 'Planning Required', 'Not Required'))  

###########################################################################
# New Datasets: 'df' with 'summarise_df'
# Dataset 'df' was merged with 'summarise_df' using 'listing_id' in 'available_nights_df' and 'id' in 'df'. 
# merging the dataset together
large_df<- merge(df, summarise_df, by.x = "id", by.y = "listing_id")

###########################################################################

# dropping irrelevant columns
drop = c("id","host_id", "month", "count", "county",  "student_accomodation", "room_type","term", "threshold_day_90", "planning_permission", "rent_pressure_zone", "per_day_rent_AirBnB", "per_year_rent_AirBnB", "max_price", "mean_price", "min_price")

large_df <- large_df[names(large_df) %in% drop] 
###########################################################################
# assigning colors to specific variable 
# will be used in graphs to ensure that the colours remain the same.
# creates association with colour and variables

#RPZ or Non-RPZ
pressure_colors = c( "#316395", "#D62728")

#entire rental unit, private room, shared room
room_colors = c('#54A24B', '#72B7B2', '#B279A2')

# rent or AirBnB
rent_colors = c('#565656', '#F58518')

#over-90 or under-90
threshold_colors = c('#FF9DA6', '#72B7B2')

planning_colors = c('#D62728','#BABDAC')


# availability
reverse_viridis = c( "#FDE725FF",
                     '#B8DE29FF',
                     '#73D055FF',
                     '#29AF7FFF',
                     '#1F968BFF',
                     '#2D708EFF',
                     '#39568CFF',
                     '#482677FF',
                     "#440154FF")
```


# Final Dataset
- `r nrow(df) ` rows
- `r ncol(df)` columns
- AirBnB listings available between 23rd October 2021 to 21st October 2022
- Any past AirBnB are not included in our dataset

**Data Dictionary**

| Field | Type  | Description |
|:-|:-|:-|
| id | integer | AirBnB's unique identifier for the listing |
| name | text | Title of the property on AirBnB |
| host_id | interger | AirBnB's unique identifier for the host |
| host_name | text | Host's name |
| lea | text | Local Electoral Areas (LEAs) |
| council | text | County or City Council  |
| county | text | County of the AirBnB Listing  |
| latitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| longitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| room_type | string | Entire rental unit, Private room, Shared room, Hotel room |
| price | currency | Daily price in local currency |
| minimum_nights | integer | minimum number of night stay for the listing (calendar rules may be different) |
| availability_365 | integer | availability_x. The availability of the listing x days in the future as determined by the calendar. Note a listing may be available because it has been booked by a guest or blocked by the host |
| student_accomodation | logical | Whether TRUE or FALSE |
| total_income | interger | AirBnB listings potential total income (available nights * price) |
| threshold_day_90 | text | Whether over-90 or under-90 days |
| term | text | Whether the AirBnB listing is available for long-term lease or short-term lease |
| per_day_rent_AirBnB  | text | Whether the property should be AirBnBed or rented our based on daily price |
| per_year_rent_AirBnB | text | Whether the property should be AirBnBed or rented our based on potential income |

# AirBnB Overview
**Where are the AirBnB listings in Ireland?**
```{r echo=FALSE, warning=FALSE}
# creating a map of Ireland with AirBnB listings
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(df, lat = ~latitude, lon = ~longitude, color = ~county)
fig <- fig %>% add_markers(marker = list(opacity = 0.4), showlegend = FALSE,
                
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights))
fig <- fig %>% layout(
    title = ' ', geo = g)

fig
```

**Which counties have the most AirBnB listings in Ireland?**
```{r warning=FALSE, echo=FALSE}
df %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          
          hovertemplate = ~paste("County:", county, "<br>", "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title= ' ')
```

**When are most AirBnB listings Available?**
```{r echo=FALSE,  warning=FALSE}
# creating a dataset of the table above
sum_df <- summarise_df %>% 
  select(listing_id, month) %>% 
  group_by(month) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(listing_id))


sum_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~month,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = " ")
```

# Breakdown by County
**What type of accomodation is most common in each county?**
```{r warning=FALSE, echo=FALSE,  message=FALSE}
df %>%
  count(room_type, county) %>%
  mutate(room_type = fct_reorder(room_type, n, .desc = TRUE)) %>%
  plot_ly(x = ~room_type, y = ~n, color = ~room_type,
          hovertemplate = ~paste("County:", county, "<br>", "Accomodation Type:", room_type, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE,  frame = ~county) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = " ")
```

**What is the price of each type of accomodation for each county?**
```{r warning=FALSE, echo=FALSE, message=FALSE}
df %>%
  plot_ly(x = ~room_type, y = ~price, color = ~room_type) %>%
  add_boxplot(frame = ~county, showlegend = FALSE) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title=" ",
    boxmode = "group") 
```

**When are the most AirBnB listings Available?**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
# creating a dataset of the table above
sum_month_df <- large_df %>% 
  select(id, month, county) %>% 
  group_by(month, county) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

sum_month_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~month,
          hovertemplate = ~paste("County:", county, "<br>", "Month:", month, "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~county, showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = " ")
```

# Rent Pressurised Zones
**Which AirBnB listings are in the Rent Pressure Zones?**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
# creating a map of Ireland with AirBnB listings in Rent Pressure Zone differentiated 
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(df, lat = ~latitude, lon = ~longitude, color = ~rent_pressure_zone)
fig <- fig %>% add_markers(marker = list(opacity = 0.2), showlegend=FALSE, colors = pressure_colors,
                          
                          hovertemplate = ~paste("County:", county, "<br>", "LEA:", lea, "<br>", 
                                        "Council:", council, "<br>",
                                        "Price (in €):", price, "<br>",
                                        "Room Type", room_type, "<br>",
                                        "Mininum stay (in nights)", minimum_nights, "<br>",
                                        "Availability (in nights)", available_nights, "<br>",
                                        "Rent Pressure Zone", rent_pressure_zone, "<br>",
                                        "Student Accomodation:",student_accomodation))
fig <- fig %>% layout(
    title = ' ', geo = g)

fig
```

**What Room Types are available inside and outside Rent Pressure Zones?**
```{r echo=FALSE,  message=FALSE}
df %>%
  count(rent_pressure_zone, room_type) %>%
  mutate(room_type = fct_reorder(room_type, n, .desc = TRUE)) %>%
  plot_ly(x = ~room_type, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("Rent Pressure Zone:", rent_pressure_zone, "<br>",
                        "Accomodation Type:", room_type, "<br>", 
                        "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE), title=" ",
          yaxis = list(title = "Number of AirBnB listings"))
   
```

**What rooom type is cheaper inside or outside of Rent Pressure Zones?**
```{r warning=FALSE, echo=FALSE,  message=FALSE}
df %>%
  plot_ly(x = ~room_type, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(marker = list(opacity = 0.2), showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title=" ",
    boxmode = "group") 
   
```
**When are the most AirBnB listings Available, examining by Rent Pressure Zone?**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
# creating a dataset of the table above
sum_rpz_df <- large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

sum_rpz_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~rent_pressure_zone,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "Rent Pressure Zone:", rent_pressure_zone , "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~rent_pressure_zone, showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = " ")
```

# Entire Rental Unit
```{r echo=FALSE,  message=FALSE}
# create new dataset where filtered by 'Entire rental unit'
entire <-  df %>% 
  filter(room_type =='Entire rental unit')
```

**Where are the most AirBnB Listings of Entire Rental Units??**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
entire %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          hovertemplate = ~paste("County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"), 
         barmode = 'stack',
         title=' ')
```


**Breakdown of Price of Entire Rental Unit AirBnB listings by RPZ and County**
```{r warning=FALSE, echo=FALSE}
entire %>%
  plot_ly(x = ~rent_pressure_zone, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(frame = ~county,showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title=" ",
    boxmode = "group") 
```

**Which AirBnB Listings are in Require Planning Permission?**

Planning permission: for listing in Rent Pressure Zones if entire rental unit is leased for short-term lets of more than 90 days in total (Citizensinformation.ie, no date).

```{r echo=FALSE,  message=FALSE}
entire %>%
  count(rent_pressure_zone, threshold_day_90, planning_permission) %>%
  mutate(threshold_day_90 = fct_reorder(threshold_day_90, n, .desc = TRUE)) %>%
  plot_ly(x = ~threshold_day_90, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("Rent Pressure Zone:", rent_pressure_zone, "<br>",
                        "Threshhold:", threshold_day_90, "<br>", 
                        "Number of AirBnB listings:", n,"<br>", 
                        "Planning Required:", planning_permission)) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title=' ')
   
```

**What is the availability for each Entire Rental Unit AirBnB listing?**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
# creating a map of Ireland with AirBnB entire rental units listings in Rent Pressure Zone 

g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(entire, lat = ~latitude, lon = ~longitude, color = ~available_nights)
fig <- fig %>% add_markers(marker = list(opacity = 0.4), 
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_year_rent_AirBnB))
fig <- fig %>% layout(
    title = ' ', geo = g)

fig
```

**When are the most Entire Rental Units AirBnB listings Available  in Rent Pressure Zone?**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
# create new dataset where filtered by 'Entire rental unit'
entire_large_df <-  large_df %>% 
  filter(room_type =='Entire rental unit')

# creating a dataset of the table above
entire_sum_rpz_df <- entire_large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

entire_sum_rpz_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~rent_pressure_zone,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "Rent Pressure Zone:", rent_pressure_zone , "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~rent_pressure_zone, showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = " ")
```

**Which Entire Rental Units should be rented out? <br> Profitability PER YEAR?**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(entire, lat = ~latitude, lon = ~longitude, color = ~per_year_rent_AirBnB)
fig <- fig %>% add_markers(marker = list(opacity = 0.4),colors = rent_colors,
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", total_income, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_year_rent_AirBnB))
fig <- fig %>% layout(
    title = ' ', geo = g)

fig
```


# Private Room
```{r echo=FALSE}
# create new dataset where filtered by 'Private Room'
private_room <-  df %>% 
  filter(room_type =='Private room')

```

**Where are the most AirBnB Listings of Private Rooms?**
```{r echo=FALSE,  warning=FALSE, message=FALSE}
private_room %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          hovertemplate = ~paste("County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"), 
         barmode = 'stack',
         title=' ')
```

**Breakdown of Price of Entire Rental Unit AirBnB listings by RPZ and County**
```{r warning=FALSE, echo=FALSE}
private_room %>%
  plot_ly(x = ~rent_pressure_zone, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(frame = ~county,showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title=" ",
    boxmode = "group") 
```

**Profitability PER YEAR**
```{r echo=FALSE,  warning=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(private_room, lat = ~latitude, lon = ~longitude, color = ~per_year_rent_AirBnB)
fig <- fig %>% add_markers(marker = list(opacity = 0.4), showlegend = FALSE, colors = rent_colors,
                
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_day_rent_AirBnB))
fig <- fig %>% layout(
    title = 'Which Private Rooms should be rented out?', geo = g)

fig
```

**Which AirBnB Listings *would* in Require Planning Permission?**

Planning permission: for listing in Rent Pressure Zones if entire rental unit is leased for short-term lets of more than 90 days in total (Citizensinformation.ie, no date). No planning permission is required for private rooms. 
```{r echo=FALSE}
private_room %>%
  count(rent_pressure_zone, threshold_day_90) %>%
  mutate(threshold_day_90 = fct_reorder(threshold_day_90, n, .desc = TRUE)) %>%
  plot_ly(x = ~threshold_day_90, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("Rent Pressure Zone:", rent_pressure_zone, "<br>",
                        "Threshhold:", threshold_day_90, "<br>", 
                        "Number of AirBnB listings:", n,"<br>")) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title='AirBnB listings by Threshold and Rent Pressure Zone')
   
```

**When are the most Private Room AirBnB listings Available <br> in Rent Pressure Zones?**
```{r warning=FALSE, echo=FALSE,  message=FALSE}


# creating a dataset 
private_sum_rpz_df <- large_df %>% 
  select(id, month, room_type, rent_pressure_zone) %>% 
  filter(room_type =='Private room') %>% 
  group_by(month, rent_pressure_zone) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

private_sum_rpz_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~rent_pressure_zone,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "Rent Pressure Zone:", rent_pressure_zone , "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~rent_pressure_zone, showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
        yaxis = list(title = "Number of AirBnB listings"),
        title = " ")
```


**Availability**
```{r echo=FALSE,  warning=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(private_room, lat = ~latitude, lon = ~longitude, color = ~available_nights)
fig <- fig %>% add_markers(marker = list(opacity = 0.4),
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_year_rent_AirBnB))
fig <- fig %>% layout(
    title = 'Availability for Private Room', geo = g)

fig
```

# Top Hosts with the most listings on AirBnB in Rent Pressure Zones
```{r message=FALSE, warning=FALSE, echo=FALSE}
# creating a dataframe with host_id and count, arranging by count
rpz_top_hosts <-  df %>% 
  select(rent_pressure_zone, host_id, host_name) %>% 
  filter(rent_pressure_zone == 'RPZ') %>% 
  group_by(host_id) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  # get all hosts with more than 10 properties on AirBnB
  filter( count > 10)
  
rpz_df <-  df %>% 
  filter(rent_pressure_zone == 'RPZ')

# creating a list of the top 5 hosts using host_id
rpz_top_hosts_list <- c(rpz_top_hosts$host_id)

# creating a new dataframe that only selects host_in in Top 20 hosts
rpz_top_df <- rpz_df %>% 
  filter(host_id %in% rpz_top_hosts_list)
```

**Location of Properties owned by Top AirBnB listings**
```{r warning=FALSE, echo=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(rpz_top_df, lat = ~latitude, lon = ~longitude, color = ~host_name)
fig <- fig %>% add_markers(
                            hovertemplate = ~paste("Host ID:", host_id, "<br>", 
                                                   "Host Name:", host_name, "<br>", 
                                                   "County:", county, "<br>", 
                                                  "Price (in €):", price, "<br>",
                                                  "Room Type", room_type, "<br>",
                                                  "Rent Pressure Zones", rent_pressure_zone, "<br>",
                                                  "Mininum stay (in nights)", minimum_nights, "<br>",
                                                  "Availability (in nights)", available_nights, "<br>"))
fig <- fig %>% layout(
    title = 'Top Hosts with the Most AirBnB listings in Rent Pressure Zone', geo = g)

fig
```

**Room Type in Top Hosts in Rent Pressure Zones by County**
```{r warning=FALSE, echo=FALSE, fig.align = 'center'}
rpz_top_df %>%
  count(room_type, county) %>%
  mutate(room_type = fct_reorder(room_type, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          hovertemplate = ~paste("Accomodation Type:", room_type, "<br>", 
                                 "County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE,  frame = ~room_type) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
          title = "What is the breakdown by Top Hosts properties in Rent Pressure Zone <br> by room type and County?")
```

# Student Accomodation
```{r warning=FALSE, echo=FALSE,message=FALSE}
student_df <- df %>% 
  filter(student_accomodation == TRUE)
```

**How many AirBnBs target Students?**
```{r echo=FALSE, warning=FALSE, message=FALSE}
df %>%
  count(student_accomodation) %>%
  mutate(student_accomodation = fct_reorder(student_accomodation, n, .desc = TRUE)) %>%
  plot_ly(x = ~student_accomodation, y = ~n, color = ~student_accomodation,
          
          hovertemplate = ~paste("Student Accomodation:", student_accomodation, "<br>",
                        "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend=FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title=' ')
   
```

**AirBnB listings targetting Students by County**
```{r warning=FALSE, echo=FALSE,  message=FALSE}
student_df %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          
          hovertemplate = ~paste("County:", county, "<br>", "Number of AirBnB listings:", n)) %>%
  add_bars() %>%
  layout(xaxis = list(title = "County"),
          yaxis = list(title = "Number of AirBnB listings per County"),
          title = "Where are AirBnB listings targetting Students?")
```

**AirBnB hosts that target students**
```{r warning=FALSE, echo=FALSE,  message=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(student_df, lat = ~latitude, lon = ~longitude, color = ~host_id,
                
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", availability_365, "<br>",
                        "Student Accomodation:",student_accomodation))
fig <- fig %>% add_markers()
fig <- fig %>% layout(
    title = 'Location of properties Targetting Students', geo = g)

fig
```

**Type of Accomodation available to Students**
```{r warning=FALSE, echo=FALSE, fig.align = 'center'}
student_df %>%
  count(county, room_type) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~room_type, y = ~n, color = ~county,
          
          hovertemplate = ~paste("Accomodation Type:", room_type, "<br>", 
                                 "County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars() %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
          title = "What is the accomodation type for AirBnB listings targetting students?")
```

# Homelessness
```{r echo=FALSE, fig.align = 'center'}
homeless_order <- homelessness_df %>% 
  select(homeless_county, number) %>% 
  arrange(desc(number))
```

**Homelessness by County or Region**
```{r warning=FALSE, echo=FALSE, fig.align = 'center'}

xform <- list(categoryorder = "array",
              categoryarray = c(unique(homeless_order$homeless_county)),
              title = FALSE)

homeless_order %>%
  plot_ly(x = ~homeless_county, y = ~number, color = ~homeless_county,
          
          hovertemplate = ~paste("County:", homeless_county, "<br>", "Number of Homeless People:", number)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = xform,
          yaxis = list(title = "Number of Homeless People"))
```

**AirBnB by County or Region**
```{r warning=FALSE, echo=FALSE, fig.align = 'center'}
df %>%
  count(homeless_county, room_type) %>%
  mutate(homeless_county = fct_reorder(homeless_county, n, .desc = TRUE)) %>%
  plot_ly(x = ~homeless_county, y = ~n, color = ~room_type,
          
          hovertemplate = ~paste("County:", homeless_county, "<br>", "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE, colors = room_colors) %>%
  layout(xaxis = xform,
        yaxis = list(title = "Number of AirBnB listings"),
         barmode = 'stack',
         title = 'AirBnB listings by Room Type')
```

# Conclusion
- *Rent Pressure Zones:* a lot of properties in Dublin City and surrounding areas,  Cork City and commuting towns, and Galway City are in the Rent Pressure Zone.
- *Pricing Discrepancy:* No difference between price of AirBnB listings inside and outside Rent Pressure Zones but there is a difference between room types.
- *Renting is better:* AirBnB hosts would earn more, if the property is rented for long-term leasing instead of AirBnBing. 
- *Student Accomodation:* Some hosts advertise their listings to students on AirBnB.
- *Planning Permission:* required for listing in Rent Pressure Zones if entire rental unit is leased for short-term lets of more than 90 days in total. However, we suggest that this is also done for private rooms.
- *Housing Crisis:* AirBnB removes a lot of potential houses from the long-term leasing or housing market. By decreasing the number of properties (both entire rental units and private rooms) available on AirBnB and moving them to the long-term rental market would release pressure of the Housing Crisis.

# The End

Thank you for your time
