---
title: "Karina.Jonina.Project"
author: "KarinaJonina"
date: "5/1/2022"
output:
  html_document:
    df_print: paged
    toc: true
    theme: united
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Student Information
- Student Name:   Karina Jonina
- Student Code:   c00278440
- Module Title:   Data Visualisation and Insight
- Module Code:    DATAC5202
- Module Leader:  Agnes Maciocha
- Course Name:    Master of Science in Data Science
- Course Code:    CW_KCDAR_M
- Due Date:       5th January 2022



```{r echo=FALSE, warning=FALSE, message=FALSE}
#installing necessary package
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("dplyr")) install.packages("dplyr")
if (!require("stringr")) install.packages("stringr")
if (!require("knitr")) install.packages("knitr")
if (!require("plotly")) install.packages("plotly")
if (!require("forcats")) install.packages("forcats")
if (!require("crosstalk")) install.packages("crosstalk")

library(ggplot2)
library(dplyr)
library(stringr)
library(knitr)
library(plotly)
library(forcats)
library(crosstalk)
```



# Introduction
The aim of this project is tell a story about AirBnB listings through graphs in plotly package and dplyr packages in R.

Housing Crisis in Ireland is a hot topic at the moment, which is affecting vast number of people, both young and old. AirBnB is the leading short-term lease of a private property website, where individuals place their homes on AirBnB to lease it to tourists on a short-term basis. 

In this report, I will be examining the impact of AirBnB on Irish Housing Crisis, by analysing AirBnB listings data by examining the RTZs from Residential Tenancies Board, Irish housing report from Daft.ie and the Homelessness Report from the Irish government. 

To fully take advantage the beauty of plotly interactivity, please knit this file into a HTML file. This will allow you, as the reader, to interact with the graphs. If the project in knitted into a word document, then the graphs will not be displayed, only tables will be displayed, which were created using dplyr.  

Please note: two Rmd files were submitted, one analysing AirBnB data, the other treating and extracting important information from 'calendar.csv'. That dataset that has over 9 million rows, which affected computer run time, knitting time and code execution, so it was summarised and two datasets emerged from that dataset, which were used in this report.

## Files submitted
- listings.csv - AirBnB listings in Ireland from the beginning of AirBnB operating in Ireland
- calendar.csv - AirBnB listings from 23rd October 2021 to 21st October 2021 (dates not chosen by student, supplied by AirBnB), contains 9 million rows.
- homeless_September_2021.csv - Homeless Report, which is published every month by the Irish government, captures statistics about homelessness (Department of Housing, Local Government and Heritage, 2021). The csv was manually created from this report. 
- rent_pressure_zones.csv -RTZs (RPZs) were developed by the Irish government to tackle rising rents lack of affordable rental units. These are areas located in parts of the country where rents are the highest and rising, and where households have the greatest difficulty finding affordable accommodation (Residential Tenancies Board, 2021). The csv was manually created from RTB website. 
- rent_in_ireland.csv - The website daft.ie is the leading property website in Ireland, which publishes reports on the Irish housing market every quarter. For this next dataset, the report Q2 2021 was used to find out the rent in each city and county in Ireland (Lyons, 2021). The csv was manually created from the report. 
- Karina.Jonina.Project.html - Document presents Karina.Jonina.Project.Rmd in HTML


Due to the 9 million rows in calendar.csv, it was decided to treat this dataset outside of this analysis due to the size of it. 

- calendar_df.Rmd - Code to treat calendar.csv and create the two datasets below to analyse in this report
- summarise_df.csv - A new dataset from calendar.csv  was created, where listings were examined by availability for each month within a year (23rd October 2021 to 21st October 2022).
- available_nights_df.csv - A new dataset summarising the number of available nights for each listing in a year (23rd October 2021 to 21st October 2022).
- calendar_df.html - Document presents calendar_df.Rmd in HTML


**Presentation** 

- Karina.Jonina.Project.Presentation.Rmd - Rmd file for presentation
- Karina.Jonina.Project.Presentation.html - Document presents Karina.Jonina.Project.Presentation.Rmd - Rmd in HTML for presentation due on the 12th January 2022. 

## Abbreviations
- LEA - Local Electoral Areas
- RPZ - RTZ
- RTB - Residential Tenancies Board

# Business Understanding
### Housing Crisis
There is a huge housing crisis in Ireland, which has been defined as a shortage of affordable accommodation for renting or buying.  Irish government has made attempts to reduce the housing crisis with plans of affordable and social housing, however, lobbyists criticise the government for late intervention and lack of innovative solutions. Both young adults (under 35 years old) and more older adults are worrying about not being able to afford a home because of rent prices and increasing house prices. 

### Rent Report
Rent prices all over Ireland are increasing and Irish people worry about the affordability of rent, considering in areas like Dublin, individuals can pay up to 50% of their salary for rent. This is very nerve-wracking experience for the tenants.
Daft.ie is the leading property website in Ireland, which publishes reports on the Irish housing market every quarter. For this next dataset, the report Q2 2021 was used to find out the rent in each town and city in Ireland (Lyons, 2021) . 

### Rent Pressure Zones
To deal with rising rents and lack of affordable rental units, the government introduced Rent Pressure Zones (RPZs). These are areas located in parts of the country where rents are highest and rising, and where households have the greatest difficulty finding affordable accommodation (Residential Tenancies Board, 2021).  Currently, there are six Local Authority Areas and 48 Local Electoral Areas (LEA) which have been designated as RTZs.  In these areas, the rent cannot be increased by more than general inflation. The list is available to be viewed on Residential Tenancies Board (RTB) (Residential Tenancies Board, 2021). 

### Homelessness
Due to the Irish rent prices, more and more individuals are loosing their homes and end up homeless on the streets. Some are homeless and are recoded in the data collected by the Irish government by Simon Community and Focus Ireland. However, there is a cohort of homeless people who live on couches of friends and families are not represented in the data. As the second quarter of 2021, there are over 4,000 adults homeless in Dublin. Homeless Report, which is published every month, captures homeless statistics (Department of Housing, Local Government and Heritage, 2021).  

### AirBnB
AirBnB hosts and AirBnB, itself, have been strongly criticised for the increase of listings for short-term leasing for tourism. It has been reported that over 30,000 Irish listings on the site in Ireland for short-term lease (Pope, 2021). The article from The Irish Times continues to state that nearly half of those listings are rooms in private homes and over 10,000 entire homes are available all-year-round.

There have been talks of the Irish government to "bring legislation to create new measures that would target at least some of those properties and may see them return to the long-term rental market.  Any moves which curtail the availability of AirBnB in popular tourism destinations around the country are likely to have a knock-on impact on accommodation availability and prices once international tourism resumes in a significant way in the post-pandemic period" (Pope, 2021). At the start of the pandemic,  figures from estate agent Sherry FitzGerald show the number of properties available for rent in Dublin rose from 1,593 in November 2019 to 3,039 by the end March 2020  (Burke-Kennedy, 2021).

### Potential Long-Term Use of Accommodation Type at AirBnB
- Entire Rental Unit – this could be a house or an apartment.  For this report, entire rental units will be viewed as a possible long-term accommodation for a family.
- Private Room – this is a private room in a shared house.  This type of accommodation is usually used by students for the academic months of the year or young professionals (all year around).
- Shared Room – this is a shared room in a shared house.  This type of accommodation is usually used by students for the academic months of the year.

### Research Question
1.	What is the impact of AirBnB on Irish Housing Crisis? 
2.	Can moving entire rental units and private rooms from AirBnB listings take the pressure of the Irish Housing Crisis?

A lot of thought was brought to decided how to analyse and visualise the AirBnB data to answer the research questions above, so the following questions were developed as a lens to aid answering above questions.

1.	How many entire houses, private rooms and shared rooms are located in Pressure Rent Zones?
2.	How do AirBnB listings in RPZs compare to the rest of country on number of listings, room type, price, minimum nights, etc? 
3.	When are these AirBnB listings available?
4.	How many entire houses in AirBnB listings, located in Pressure Rent Zones, are above 90-day threshold, requiring planning permission for the local authority?
5.	How many AirBnB listings are available for longer than short-term lease (14-days)?
6.	How many AirBnB listings, located in Pressure Rent Zones, target students?
7.	Which hosts own the most of AirBnB listings located in Pressure Rent Zones? How many listings are there? What is the average price, minimum stay, availability? What is the lease type and is it over the threshold?
8.	Should landlords rent their property or put it on AirBnB? Which is more profitable?
9.	What is the comparison between AirBnB listings and homeless figures?

# Data Understanding
### AirBnB listings in Ireland
Dataset used about properties listed on AirBnB in Ireland up to 21st October 2021. It was downloaded from http://insideAirBnB.com/get-the-data.html (listing.csv).

Data Dictionary was summarised from https://docs.google.com/spreadsheets/d/1iWCNJcSutYqpULSQHlNyGInUvHg2BoUGoNRIGa6Szc4/edit#gid=982310896

This dataset contains information about the AirBnB Listing such as listing id, host id, name, number of reviews, daily price. More columns will be presented in Data Understanding section.

```{r}
# reading the csv
df =  read.csv('listings.csv')
```

In 'df' dataset, there are `r nrow(df) ` rows and `r ncol(df)` columns. Columns names are  `r colnames(df)`.

```{r}
#check the class of df
class(df)
```

```{r}
#check the column names for  df
colnames(df)
```

```{r}
# examining the structure in df
str(df)
```

```{r}
# examining the top 5 rows in df
head(df)
```

```{r}
# examining summary of all numeric columns in df
summary(df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| id | integer | AirBnB's unique identifier for the listing |
| name | text | Title of the property on AirBnB |
| host_id | interger | AirBnB's unique identifier for the host |
| host_name | text | Host's name |
| neighbourhood | text | Local Electoral Areas (LEAs) |
| neighbourhood_group | text | County or City Council  |
| latitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| longitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| room_type | string | Entire house/apt, Private room, Shared room, Hotel room |
| price | currency | Daily price in local currency |
| minimum_nights | integer | minimum number of night stay for the listing (calendar rules may be different) |
| number_of_reviews | integer | The number of reviews the listing has |
| last_review | date | The date of the last/newest review |
| calculated_host_listings_count | integer | The number of listings the host has in the current scrape, in the city/region geography |
| availability_365 | integer | availability_x. The availability of the listing x days in the future as determined by the calendar. Note a listing may be available because it has been booked by a guest or blocked by the host |
| number_of_reviews_ltm | integer | The number of reviews the listing has (in the last 12 months) |
| licence | string | Unclear from data dictionary provided by AirBnB |


### Dateset 'summarise_df'
Dateset 'summarise_df'  was created from 'calendar.csv', which was downloaded from the AirBnB website. It was downloaded from http://insideAirBnB.com/get-the-data.html (calendar.csv).  This dataset is between 23rd October 2021 to 21st October 2022. This dataset states whether the AirBnB listing is available on a specific date.

To examine how this dataset was created please see Rmd file called 'calendar_df.Rmd'

```{r}
# reading the csv
summarise_df =  read.csv('summarise_df.csv')
```

In 'summarise_df' dataset, there are `r nrow(summarise_df)` rows and `r ncol(summarise_df)` columns in the dataset.
Columns names are  `r colnames(summarise_df)`.
```{r}
#check the class of summarise_df
class(summarise_df)
```

```{r}
#check the column names for  summarise_df
colnames(summarise_df)
```

```{r}
# examining the structure in summarise_df
str(summarise_df)
```

```{r}
# examining the top 5 rows in summarise_df
head(summarise_df)
```

```{r}
# examining summary of all numeric columns in summarise_df
summary(summarise_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| listing_id | integer | AirBnB's unique identifier for the listing |
| month | date | Month of the year |
| count | integer | Number of nights available in that month |
| min_price | integer | Minimum price for that listing in that month |
| mean_price | integer | Mean price for that listing in that month |
| max_price | integer | Maximum price for that listing in that month |

### Dateset 'available_nights_df' 
Dateset 'available_nights'  was created from 'calendar.csv', which was downloaded from the AirBnB website. It was downloaded from http://insideAirBnB.com/get-the-data.html (calendar.csv).  This dataset is between 23rd October 2021 to 21st October 2022. This dataset states whether the AirBnB listing is available on a specific date.

To examine how this dataset was created please see Rmd file called 'calendar_df.Rmd'

```{r}
# reading the csv
available_nights_df =  read.csv('available_nights_df.csv')
```

In 'available_nights_df' dataset, there are `r nrow(available_nights_df)` rows and `r ncol(available_nights_df)` columns in the dataset.
Columns names are  `r colnames(available_nights_df)`.
```{r}
#check the class of available_nights_df
class(available_nights_df)
```

```{r}
#check the column names for  available_nights_df
colnames(available_nights_df)
```

```{r}
# examining the structure in available_nights_df
str(available_nights_df)
```

```{r}
# examining the top 5 rows in available_nights_df
head(available_nights_df)
```

```{r}
# examining summary of all numeric columns in available_nights_df
summary(available_nights_df)
```































### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| listing_id | integer | AirBnB's unique identifier for the listing |
| available_nights | integer | Number of nights avaible during the year |

### RTZs
RTZs (RPZs) were developed by the Irish government to tackle rising rents lack of affordable rental units. These are areas located in parts of the country where rents are the highest and rising, and where households have the greatest difficulty finding affordable accommodation (Residential Tenancies Board, 2021). The csv was manually created from RTB website. 

```{r}
# reading the csv
rpz_df =  read.csv('rent_pressure_zones.csv')
```

In 'rpz_df' dataset, there are `r nrow(rpz_df)` rows and `r ncol(rpz_df)` columns. Columns names are  `r colnames(rpz_df)`.
```{r}
#check the class of rpz_df
class(rpz_df)
```

```{r}
#check the column names for  rpz_df
colnames(rpz_df)
```

```{r}
# examining the structure in rpz_df
str(rpz_df)
```

```{r}
# examining the top 5 rows in rpz_df
head(rpz_df)
```

```{r}
# examining summary of all numeric columns in rpz_df
summary(rpz_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| neighbourhood | text | LEA or County Council e.g. Kildare County Council and Naas LEA |
| rpz | logical | Stating whether the area is in RTZs (RPZ): true or false |

### Rent Prices in Ireland
The website daft.ie is the leading property website in Ireland, which publishes reports on the Irish housing market every quarter. For this next dataset, the report Q2 2021 was used to find out the rent in each city and county in Ireland (Lyons, 2021). The csv was manually created from the report. 

```{r}
# reading the csv
rent_df =  read.csv('rent_in_ireland.csv')
```

In 'rent_df' dataset, here are `r nrow(rent_df)` rows and `r ncol(rent_df)` columns. Columns names are `r colnames(rent_df)`.
```{r}
#check the class of rent_df
class(rent_df)
```

```{r}
#check the column names for  rent_df
colnames(rent_df)
```

```{r}
# examining the structure in rent_df
str(rent_df)
```

```{r}
# examining the top 5 rows in rent_df
head(rent_df)
```

```{r}
# examining summary of all numeric columns in rent_df
summary(rent_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| county_city | text | County or City, e.g. County Galway and Galway City |
| rent_price_per_month | integer | Average price of a rental property in an area |


### Homelessness 
Homeless Report, which is published every month by the Irish government, captures statistics about homelessness (Department of Housing, Local Government and Heritage, 2021). The csv was manually created from this report. 

```{r}
# reading the csv
homelessness_df =  read.csv('homeless_September_2021.csv')
```

In 'homelessness_df' dataset, there are `r nrow(homelessness_df)` rows and `r ncol(homelessness_df)` columns. Columns names are `r colnames(homelessness_df)`.
```{r}
#check the class of homelessness_df
class(homelessness_df)
```

```{r}
#check the column names for  homelessness_df
colnames(homelessness_df)
```

```{r}
# examining the structure in homelessness_df
str(homelessness_df)
```

```{r}
# examining the top 5 rows in homelessness_df
head(homelessness_df)
```

```{r}
# examining summary of all numeric columns in homelessness_df
summary(homelessness_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| county | text | County Council e.g. Kildare meaning Co.Kildare. Some counties are grouped together. |
| number | integer | Number of homeless individuals in that county |


## Data Preparation
### Dataset 'summarise_df'
Column 'month' had to be declared a category and ordering of months had to occur.
```{r}
# changing 'month' to factor
summarise_df$mmonth <- as.factor(summarise_df$month)

# changing  the order of factors
summarise_df$month <- factor(summarise_df$month, levels = c("January", "February", "March","April", "May", "June","July", "August", "September","October", "November", "December"))
```

### Dataset 'df'
```{r echo=FALSE}
str(df)
```

```{r echo=FALSE}
# converrting last_review to a date format
# df <- as_tibble(df)
# df$last_review <- as.POSIXct(df$last_review)
# str(df)
```

```{r echo=FALSE}
# assigning factor to host_id
df$host_id <- as.factor(df$host_id)

# assigning factor to id
df$id <- as.factor(df$id)
```

### License
License has no unique values, therefore, it was dropped from the dataset.
```{r}
# examining unique values in column 'license'  
unique(df$license)
```

```{r echo=FALSE}
# dropping column 'license' because it is empty
df<- df %>% 
  # keep all columns except 'license'
  select(-license)
```

```{r}
#examining the columns names of df to make sure 'license' is dropped
colnames(df)
```


### Number of Listings per Host
The minimum  number of listings the host has in the current scrape, in the city/region geography  `r min(df$calculated_host_listings_count)` nights and is `r max(df$calculated_host_listings_count)`. On average, there are `r mean(df$calculated_host_listings_count)` listings per host. There are no issues with this column because the minimum of listings has to 1 (otherwise, the host has no listings on AirBnB).

```{r}
summary(df$calculated_host_listings_count)
```

### Number of Reviews in the last 12 months
The minimum number of reviews in the last 12 months was for an AirBnB listing is  `r min(df$number_of_reviews_ltm)` nights and the maximum of number of reviews is `r max(df$number_of_reviews_ltm)`. On average, in the last 12 months, there were `r mean(df$number_of_reviews_ltm)` reviews per listing.

```{r}
summary(df$number_of_reviews_ltm)
```

```{r echo=FALSE}
df %>%
  plot_ly(x = ~number_of_reviews_ltm) %>% 
  add_histogram() %>% 
  layout(xaxis = list(title = "Number of Reviews (12 Months)"),
          yaxis = list(title = "# of Observations"),
          title = "Histogram of Number of Reviews (12 Months)")
```

### Number of Reviews
The minimum price for an AirBnB listing is  `r min(df$number_of_reviews)` and the maximum is `r max(df$number_of_reviews)`.  On average, there are `r mean(df$number_of_reviews)` reviews per listing.
```{r}
summary(df$number_of_reviews)
```

```{r echo=FALSE}
df %>%
  plot_ly(x = ~number_of_reviews) %>% 
  add_histogram(nbinsx = 100) %>% 
  layout(xaxis = list(title = "Reviews"),
          yaxis = list(title = "# of Observations"),
          title = "Histogram of Reviews")
```



### Availability
The minimum availability for an AirBnB listing is  `r min(df$availability_365)` and the maximum is `r max(df$availability_365)`. On average, the listings are available `r mean(df$availability_365)` nights  out of the year. 
```{r}
summary(df$availability_365)
```

```{r echo=FALSE}
df %>%
  plot_ly(x = ~availability_365) %>% 
  add_histogram(nbinsx = 100) %>% 
  layout(xaxis = list(title = "Availability (# of nights)"),
          yaxis = list(title = "# of Observations"),
          title = "Histogram of Availability")
```

```{r echo=FALSE}
# examining how 
df %>% 
  select(availability_365) %>% 
  filter(availability_365 == 0) %>% 
  group_by(availability_365) %>% 
  summarise(count = n())
```

After much consideration, it was decided to remove 'availability_365'. On AirBnB data dictionary, it states that '[the] availability of the listing x days in the future as determined by the calendar. Note a listing may be available because it has been booked by a guest or blocked by the host.' It is very unclear what it is meant by 0 nights available. 

```{r echo=FALSE}
# number of observations (rows) in the dataset
old_total <- nrow(df) 
```


### Merging Datasets: 'df' with 'available_nights_df'
Instead, it was decided to examine next year's availability from available_nights_df (from 23rd October 2021 to 21st October 2022) to a more accurate reading of availability. Before changing availability column, there were `r old_total` rows in the dataset. 

Dataset 'df' was merged with 'available_nights_df' using 'listing_id' in 'available_nights_df' and 'id' in 'df'. 

```{r echo=FALSE}
# merging the dataset together, merging on listings ID in each dataset. 
df <- merge(df, available_nights_df, by.x = "id", by.y = "listing_id")
```

```{r echo=FALSE}
# Histogram of availability
df %>%
  plot_ly(x = ~available_nights) %>% 
  add_histogram(nbinsx = 100) %>% 
  layout(xaxis = list(title = "Availability (# of nights)"),
          yaxis = list(title = "# of Observations"),
          title = "Histogram of Availability")
```

```{r echo=FALSE}
# number of observations (rows) in the new dataset
new_total <- nrow(df) 

# finding out how many rows were dropped from the dataset
changes <- old_total - new_total
```

After merging 'df' dataset on the columns 'id' from 'df' dataset and 'listing_df' from 'available_nights_df' dataset, there were `r new_total` rows in the dataset. `r changes` rows were dropped from the dataset. This would imply that the listings that are no longer available were dropped from the dataset. This was seen as important and accurate for answering the research questions because this would examine the amount of housing that will not be available to Irish tenants for long-term lease between 23rd October 2021 and 21st October 2022. It is unclear what happened to the `r changes` listings on the AirBnB or why they were unavailable on the stated year. This ensures that we analyse data relevant to the upcoming year, rather than examine all the previous listings of AirBnB in Ireland.

### Minimum Nights
The minimum stay for an AirBnB listing is  `r min(df$minimum_nights)` nights and the maximum of minimum nights is `r max(df$minimum_nights)` nights.  On average, the minimum stay must be `r mean(df$availability_365)` nights.  There were 6 rows that had minimum stay over 365 nights It was assumed to be an error and were dropped from the dataset.  

```{r}
summary(df$minimum_nights)
```


```{r echo=FALSE}
df %>%
  plot_ly(x = ~minimum_nights) %>% 
  add_histogram(nbinsx = 100) %>% 
  layout(xaxis = list(title = "Mininum Nights"),
          yaxis = list(title = "# of Observations"),
          title = "Histogram of Mininum Nights")
```


```{r echo=FALSE}
# select rows with minimum stays as more than 365 
df %>% 
  select(host_id, minimum_nights) %>% 
  filter(minimum_nights > 365) %>% 
  summarise(no_of_rows_more_than_365_nights = n())

```

```{r echo=FALSE}
# filtering out max outlier
df <-  df %>% 
  # dropping row where minimum_nights is  1125
  filter(!(minimum_nights > 365))
```

### After dropping the outliers
```{r echo=FALSE}
df %>%
  plot_ly(x = ~minimum_nights) %>% 
  add_histogram(nbinsx = 100) %>% 
  layout(xaxis = list(title = "Mininum Nights"),
          yaxis = list(title = "# of Observations"),
          title = "Histogram of Mininum Nights")
```

### Price
The minimum price for an AirBnB listing is  `r min(df$price)` and the maximum is `r max(df$price)`.  As stated above, column 'price' is price per day of stay. Of course, price can not be €0 and this was examined to ensure none of the rows contained '0' in price. Maximum price seems to be is `r max(df$price)` per night, which seems to be inaccurate. This row was dropped from the dataset. 

```{r}
summary(df$price)
```

```{r echo=FALSE}
# select rows with price as 0 and count rows affected
df %>% 
  select(host_id, price) %>% 
  filter(price == 0) %>% 
  summarise(no_of_rows_with_0 = n())
```


```{r echo=FALSE}
df %>%
  plot_ly(x = ~availability_365, y = ~price) %>%
  add_markers(marker = list(opacity = 0.2)) %>% 
  layout(xaxis = list(title = "Availability (# of nights)"),
          yaxis = list(title = "Price (in €)"),
          title = "Scatterplot of Availability and Price")
```


```{r echo=FALSE}
# filtering out max outlier
df <-  df %>% 
  # dropping row where price is  1173721 or 0 
  filter(!(price == 1173721 | price == 0))
```

### After dropping the outliers
After dropping the outliers, there are `r nrow(df) ` row in 'df' dataset.
```{r}
summary(df$price)
```

```{r echo=FALSE}
df %>%
  plot_ly(x = ~availability_365, y = ~price) %>%
  add_markers(marker = list(opacity = 0.2)) %>% 
  layout(xaxis = list(title = "Availability (# of nights)"),
        yaxis = list(title = "Price (in €)"),
        title = "Scatterplot of Availability and Price")
```

### Room Type
```{r echo=FALSE}
# personal preference 
df$room_type <- str_replace(df$room_type, 'Entire home/apt', 'Entire rental unit')
```
There are 4 room types: `r unique(df$room_type)`. However, hotels have planning permission with relevant authorities to host guests and lease rooms, therefore, hotels will be dropped from the data. Because of the small amount of shared rooms in the dataset, shared room were also dropped. 

```{r echo=FALSE}
df %>% 
  select(room_type) %>% 
  group_by(room_type) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```

```{r echo=FALSE}
# removing hotel
df <-  df %>% 
  filter(!(room_type == 'Hotel room' | room_type == 'Shared room')) 
```

```{r echo=FALSE}
# declaring column as a factor
df$room_type <- as.factor(df$room_type)
```


```{r}
# examining room type available in Room Type
unique(df$room_type)
```
After dropping the 'Hotel room' from the data, there are `r nrow(df) ` row in 'df' dataset.

### Neighbourhood (renamed to 'lea')
Neighboourhood has some unclean data and 'LEA' was dropped from the values in the column. 

```{r echo=FALSE}
# declaring column as a factor
df$neighbourhood <- as.factor(df$neighbourhood)
df$neighbourhood_group <- as.factor(df$neighbourhood_group)
```

```{r results='hide', echo=FALSE}
# examining unique values in column 'neighbourhood'  
unique(df$neighbourhood)
```


```{r echo=FALSE}
# getting rid of LEA from the neighbourhood
df$neighbourhood <- str_replace(df$neighbourhood, '-7', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-6', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-5', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-4', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-3', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-3', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-lea-7', ' LEA')
df$neighbourhood <- str_replace(df$neighbourhood, '-LEA', ' LEA')

# neighbourhood column is really 'lea'
df <- rename(df, lea=neighbourhood)

# declaring column as a factor
df$lea <- as.factor(df$lea)
```

```{r echo=FALSE}
# some values were still incorrect so they were manually changed
df$lea <- str_replace_all(df$lea, c('Graiguecullen -Portarlington LEA ' = 'Graiguecullen-Portarlington LEA',
                                    'Cavan - Belturbet LEA' = 'Cavan-Belturbet LEA',
                                    'Bandon - Kinsale LEA' ='Bandon-Kinsale LEA',
                                    'Bailieborough - Cootehill LEA' = 'Bailieborough-Cootehill LEA',
                                    'Laytown  Bettystown-lea' = 'Laytown-Bettystown LEA',
                                    'DÃºn Laoghaire LEA' = 'Dún Laoghaire-Rathdown County Council'))
```

```{r}
unique(df$lea)
```


### Neighbourhood Group (renamed to 'council')
```{r echo=FALSE}
# renaming neighbourhood_group to council because this is more accurate name
df<- rename(df, council = neighbourhood_group)

# declaring column as a factor
df$council <- as.factor(df$council)

# some values were still incorrect so they were manually changed
df$council <- str_replace(df$council, 'Dun Laoghaire-rathdown County Council', 'Dún Laoghaire-Rathdown County Council')
```

```{r}
# examining unique values in column 'council'  
unique(df$council)
```

### New Variable: County
A new variable 'county' was created from 'neighbourhood_group'. Several counties may have two or more county or city councils such as Cork, which has two councils: Cork City Council and Cork County Council. County Galway has two councils too: Galway City Council and Galway County Council.  Dublin has several councils: Fingal County Council, South Dublin County Council, Dún Laoghaire-Rathdown County Council, Dublin County Council. Some councils have two in one like Limerick City And County Council. To find out the county, string manipulation was conducted.

```{r echo=FALSE}
# getting rid of County Council from the council to assign county
df$county <- str_replace(df$council, ' County Council', '')
df$county <- str_replace(df$county, ' City Council', '')
df$county <- str_replace(df$county, ' City And', '')

# neighbourhood group in Dublin
df$county <- str_replace(df$county, 'Dún Laoghaire-Rathdown', 'Dublin')
df$county <- str_replace(df$county, 'Fingal', 'Dublin')
df$county <- str_replace(df$county, 'South Dublin', 'Dublin')

# assigning factor to country
df$county <- as.factor(df$county)
```

```{r}
unique(df$county)
```


### New Variable: Student Accomondation
Creating a new varible 'student_accomodation', examining whether the 'name' column contains 'student' in the description.

```{r echo=FALSE}
# Creating a new variable which detects whether 'Student' is included in the name 
df <- df %>%  
  select(everything()) %>% 
  mutate(
    student_accomodation = case_when(
      str_detect(name, "Student") ~ TRUE,
      str_detect(name, "student") ~ TRUE, 
      str_detect(name, "STUDENT") ~ TRUE, 
      str_detect(name, "Students") ~ TRUE,
      str_detect(name, "students") ~ TRUE, 
      str_detect(name, "STUDENTS") ~ TRUE, 
      TRUE ~ FALSE))
```

```{r echo=FALSE}
# examining the count of student accomodation TRUE or FALSE
df %>% 
  select(student_accomodation) %>% 
  group_by(student_accomodation) %>% 
  summarise(count = n())
```


### New Variable: Lease
Short-term lets are stays of less than 14 days at a time, for example, if you rent out your property on a booking website such as AirBnB so people can stay there for a weekend (Citizensinformation.ie, no date).

A new variable 'term' was created to state whether the listing is 'short-term lease' or 'long-term lease'. 
```{r echo=FALSE}
df <- df %>%  
  select(everything()) %>%
  mutate(term = if_else(minimum_nights <= 14, 'short-term lease', 'long-term lease'))

# assigning factor to term
df$term <- as.factor(df$term)
```

```{r echo=FALSE}
# examining the count of term 
df %>% 
  select(term) %>% 
  group_by(term) %>% 
  summarise(count = n())
```

### New Variable: 90-Day Threshold
Homeowners in RTZs (RPZs) are required to apply for planning permission if they let out their entire home (principal private residence) for short-term lets of more than 90 days in total while they are away. Principal private residence is the place where one ordinarily live (Citizensinformation.ie, no date).


A new variable 'threshold_day_90' was created to state whether the listing is 'under-90' or 'over-90' days. 
```{r echo=FALSE}
df <- df %>%  
  mutate(threshold_day_90 = if_else(availability_365 < 90, 'under-90', 'over-90'))

# assigning factor to threshold_day_90
df$threshold_day_90 <- as.factor(df$threshold_day_90)
```

```{r echo=FALSE}
# examining the count of threshold_day_90 
df %>% 
  select(threshold_day_90) %>% 
  group_by(threshold_day_90) %>% 
  summarise(count = n())
```


### New Variable: Total Income
Creating a new variable 'total_income', examining the full income potential of a listings by multiplying the price by the number of nights it is available for. 

```{r echo=FALSE}
df <- df %>%  
  select(everything()) %>%
  mutate(total_income = price*availability_365)

```

```{r}
summary(df$total_income)
```

```{r echo=FALSE}
df %>%
  plot_ly(x = ~total_income) %>% 
  add_histogram() %>% 
  layout(xaxis = list(title = "Total Income"),
          yaxis = list(title = "Number of Observations"),
          title = "Histogram of Total Income")
```


```{r echo=FALSE}
# number of observations (rows) in the dataset
old_total_income <- nrow(df) 
```

### After Dropping Outliers
There are `r old_total_income` rows in the 'df' dataset before dropping outliers. As seen above in the histogram, there are very limited amount of properties that are above €200,000 in total income per year. It was decided to drop all rows that are over €200,000 in total income because in this project, the affordable listings are examined in relation to the Irish Housing Crisis. Only the 'affordable' houses will be examined. It was unclear where to make the cut-off. It was decided to make €200,000 the cut-off even though paying potential rent of €200,000 is not affordable when a tenant is competing the AirBnB prices.  

```{r echo=FALSE}
df <-  df %>% 
  filter(total_income < 200000)
```

```{r echo=FALSE}
df %>%
  plot_ly(x = ~total_income) %>% 
  add_histogram() %>% 
  layout(xaxis = list(title = "Total Income"),
          yaxis = list(title = "Number of Observations"),
          title = "Histogram of Total Income")
```

```{r echo=FALSE}
# number of observations (rows) in the new dataset
new_total_income <- nrow(df) 

# finding out how many rows were dropped from the dataset
dropped_total_income <- old_total - new_total_income
```

After dropping all rows with total potential income from AirBnB over €200,000, there were `r new_total_income` rows in the dataset. `r dropped_total_income` rows were dropped from the dataset.


### Merging Datasets: 'df' with 'rent_df'
In 'df' dataset, a new column 'county_city' was created from 'council' to be the same as 'county_city' in 'rent_df'. 

```{r}
unique(rent_df$county_city)
```


Datasets 'df' and 'rent_df' were merged on column 'county_city'.

```{r echo=FALSE}
# getting rid of County Council from the 'council' to assign county_city
df$county_city <- str_replace(df$council, ' LEA', '')
df$county_city <- str_replace(df$county_city, ' Council', '')
df$county_city <- str_replace(df$county_city, ' City And', '')

# changing 'council' in Dublin
df$county_city <- str_replace(df$county_city, 'Dun Laoghaire-rathdown', 'Dublin')
df$county_city <- str_replace(df$county_city, 'Fingal', 'Dublin')
df$county_city <- str_replace(df$county_city, 'South Dublin', 'Dublin')
```

```{r echo=FALSE, results='hide'}
unique(df$county_city)
```

```{r echo=FALSE}
# creating a new variable 'county_city' from 'county' to match 'county_city' in 'rent_df'  
# replacing strings 
df$county_city <- str_replace_all(df$county_city, c('Carlow County' = 'County Carlow',
                                                    'Dublin County' = 'Dublin City',
                                          'Galway County' = 'County Galway',
                                          'Cork County' = 'County Cork',
                                          'Waterford County' = 'County Waterford',
                                          'Offaly County' = 'County Offaly', 
                                          'Wicklow County' = 'County Wicklow', 
                                          'Tipperary County' = 'County Tipperary', 
                                          'Monaghan County' = 'County Monaghan', 
                                          'Sligo County' = 'County Sligo', 
                                          'Wexford County' = 'County Wexford', 
                                          'Clare County' = 'County Clare', 
                                          'Donegal County' = 'County Donegal', 
                                          'Meath County' = 'County Meath', 
                                          'Westmeath County' = 'County Westmeath', 
                                          'Mayo County' = 'County Mayo', 
                                          'Kildare County' = 'County Kildare',
                                          'Kerry County'= 'County Kerry',
                                          'Louth County' = 'County Louth',
                                          'Longford County' = 'County Longford',
                                          'Leitrim County' = 'County Leitrim',
                                          'Kilkenny County'= 'County Kilkenny',
                                          'Laois County'= 'County Laois',
                                          'Roscommon County'= 'County Roscommon',
                                          'Limerick County' = 'County Limerick',
                                          'Cavan County' = 'County Cavan'))



# assigning factor to county_city  variable
df$county_city <- as.factor(df$county_city)
```


```{r echo=FALSE}
# merging the dataset together
df<- merge(df, rent_df, by.x = "county_city", by.y = "county_city")
```


### Merging Datasets: 'df' with 'homeless_county'
In 'df' dataset, a new variable 'homeless_county' was created from 'county' to hold the same values as 'homeless_county' in 'homeless_df' dataset. Several counties have been merged together in the report such as 'Mayo/Roscommon'. 

Datasets 'df' and 'homeless_df' were merged on column 'homeless_county'.
```{r echo=FALSE}
# creating a new variable 'homeless_county' from 'county' to match 'county_city' in 'homeless_df' 
# replacing strings 
df$homeless_county <- str_replace(df$county, 'Galway', 'Galway (Galway City and County councils)')
df$homeless_county <- str_replace(df$homeless_county, 'Cork', 'Cork (Cork City and County councils)')
df$homeless_county <- str_replace(df$homeless_county, 'Donegal' , '3') 
df$homeless_county <- str_replace(df$homeless_county, 'Leitrim', '3')
df$homeless_county <- str_replace(df$homeless_county, 'Monaghan' , '1') 
df$homeless_county <- str_replace(df$homeless_county, 'Louth' , '1') 
df$homeless_county <- str_replace(df$homeless_county, 'Cavan', '1')
df$homeless_county <- str_replace(df$homeless_county, 'Mayo', '2')
df$homeless_county <- str_replace(df$homeless_county, 'Roscommon', '2')

df$homeless_county <- str_replace(df$homeless_county, '2', 'Mayo/Roscommon')
df$homeless_county <- str_replace(df$homeless_county, '1', 'Louth/Monaghan/Cavan')
df$homeless_county <- str_replace(df$homeless_county, '3', 'Donegal/Leitrim')


# assigning factor to homeless_county  variable
df$homeless_county <- as.factor(df$homeless_county)
```

```{r results='hide', echo=FALSE}
unique(df$homeless_county)
```

```{r results='hide', echo=FALSE}
# examining the names of the homelessness_df dataset 
names(homelessness_df)
```

```{r echo=FALSE}
# renaming the weird column name 'ï..homeless_county' with 'homeless_county'
homelessness_df <- rename(homelessness_df, homeless_county= ï..homeless_county)
```

```{r echo=FALSE}
# merging the dataset together
df<- merge(df, homelessness_df, by.x = "homeless_county", by.y = "homeless_county")
```

### New Variable: Rent Per Day
Using rent_df (dataset with county or city and average rent), A new variable was calculated 'rent_price_per_day' which is the rent the tenant pays per day to stay in their rented property. Although this is not how this is not normally used in the renting market, this variable will be compared to the price of AirBnB, which is in 'per day'. It was decided to find the rent per day, because not all properties are leased for 365 days a year.

It was also assumed that private rooms will cost one third of an entire house to rent, i.e. if a house's rent is €1500, then a room to rent is €500. Although this is not the most accurate estimate, it is better than assuming that the price of a private room is the same as a rent of the whole house, i.e. €1500 for private room. This was also operated under the assumptions that all rooms in the house are the same size and have the same bathroom privileges, i.e. all en suite or all sharing.


```{r echo=FALSE}
# if the property is 'Entire rental unit'. then multiply rent_price_per_month by 12 (months) and divide by 365 (days)
# otherwise ('Private room' or 'Shared room') multiply rent_price_per_month by 12 (months), divide by 365 (days) and divide by 3 (rooms in the house)
df <- df %>%  
  mutate(rent_price_per_day = if_else(room_type == 'Entire rental unit', (rent_price_per_month*12)/365, ((rent_price_per_month*12)/365)/3))
```


```{r echo=FALSE}
# if the property is 'Entire rental unit'. then multiply rent_price_per_month by 12 (months) 
# otherwise ('Private room' or 'Shared room') multiply rent_price_per_month by 12 (months) and divide by 3 (rooms in the house)
df <- df %>%  
  mutate(rent_price_per_year = if_else(room_type == 'Entire rental unit', rent_price_per_month*12, (rent_price_per_month*12)/3))
```


### New Variable: Rent or AirBnB?
New variable was created to examine whether the property should be rented or AirBnB listing.

Some thought was given to whether to compare AirBnB daily price and rent per day OR total income possible from AirBnB and total income from rent. Although comparing daily AirBnB and rent per day would allow to compare the income the landlord would get on per day, it does not show whether it is actually worth while listing the property on AirBnB is more profitable than renting when taking in consideration the amount of nights that the property is available. Two varialbes were developed to examine this: per day and per year.  
If the AirBnB price is greater than price, then the property should be an AirBnB listing.
If the AirBnB price is lower than price, then the property should be rented.

```{r echo=FALSE}
# creating a new variable to state whether the property should be rented or on AirBnB
df <- df %>%  
  mutate(per_day_rent_AirBnB = if_else(price >= rent_price_per_day, 'AirBnB', 'Rent'))


# assigning factor to per_day_rent_AirBnB
df$per_day_rent_AirBnB <- as.factor(df$per_day_rent_AirBnB)
```

```{r echo=FALSE}
# examining the count of per_day_rent_AirBnB
df %>% 
  select(per_day_rent_AirBnB) %>% 
  group_by(per_day_rent_AirBnB) %>% 
  summarise(count = n())

```

``` {r echo=FALSE}
# creating a new variable to state whether the property should be rented or on AirBnB

df <- df %>%  
  select(everything()) %>%
  mutate(per_year_rent_AirBnB = if_else(total_income <= rent_price_per_year, 'AirBnB', 'Rent'))

# assigning factor to per_year_rent_AirBnB
df$per_year_rent_AirBnB <- as.factor(df$per_year_rent_AirBnB)
```

```{r echo=FALSE}
# examining the count of per_day_rent_AirBnB
df %>% 
  select(per_year_rent_AirBnB) %>% 
  group_by(per_year_rent_AirBnB) %>% 
  summarise(count = n())

```

### New Variable: RTZ

The column 'county_city' in 'rpz_df' had values which contained both values from columns 'council' and 'lea'. In this case, a new column had to be created stating whether the listing is a RTZ or not. 

```{r echo=FALSE}
unique(rpz_df$neighbourhood)
```

```{r echo=FALSE}
# Creating a new variable 
# Manually assessing whether it is TRUE or FALSE
# the list was taken from 'neighbourhood' in 'rpz_df' dataset
df <- df %>%  
  mutate(
    rent_pressure_zone = case_when(
      str_detect(council, 'Cork City Council') ~ TRUE,
      str_detect(council, 'Dublin City Council') ~ TRUE,
      str_detect(council, 'Dún Laoghaire-Rathdown County Council') ~ TRUE,
      str_detect(council, 'Fingal County Council') ~ TRUE,
      str_detect(council, 'South Dublin County Council') ~ TRUE,
      str_detect(council, 'Kildare County Council') ~ TRUE,
      str_detect(lea, 'Ballincollig–Carrigaline LEA') ~ TRUE,
      str_detect(lea, 'Galway City Central LEA') ~ TRUE,
      str_detect(lea, 'Galway City West LEA') ~ TRUE,
      str_detect(lea, 'Galway City East LEA') ~ TRUE,
      str_detect(lea, 'Drogheda LEA') ~ TRUE,
      str_detect(lea, 'Drogheda Urban LEA') ~ TRUE,
      str_detect(lea, 'Drogheda Rural LEA') ~ TRUE,
      str_detect(lea, 'Celbridge-Leixlip LEA') ~ TRUE,
      str_detect(lea, 'Naas LEA') ~ TRUE,
      str_detect(lea, 'Newbridge LEA') ~ TRUE,
      str_detect(lea, 'Ashbourne LEA') ~ TRUE,
      str_detect(lea, 'Laytown-Bettystown LEA') ~ TRUE,
      str_detect(lea, 'Ratoath LEA') ~ TRUE,
      str_detect(lea, 'Bray West LEA') ~ TRUE,
      str_detect(lea, 'Bray East LEA') ~ TRUE,
      str_detect(lea, 'Wicklow LEA') ~ TRUE,
      str_detect(lea, 'Cobh LEA') ~ TRUE,
      str_detect(lea, 'Maynooth LEA') ~ TRUE,
      str_detect(lea, 'Drogheda LEA') ~ TRUE,
      str_detect(lea, 'Greystones LEA') ~ TRUE,
      str_detect(lea, 'Limerick City East LEA') ~ TRUE,
      str_detect(lea, 'Navan LEA') ~ TRUE,
      str_detect(lea, 'Fermoy LEA') ~ TRUE,
      str_detect(lea, 'Midleton LEA') ~ TRUE,
      str_detect(lea, 'Athenry-Oranmore LEA') ~ TRUE,
      str_detect(lea, 'Gort-Kinvara LEA') ~ TRUE,
      str_detect(lea, 'Kilkenny LEA') ~ TRUE,
      str_detect(lea, 'Graiguecullen-Portarlington LEA') ~ TRUE,
      str_detect(lea, 'Portlaoise LEA') ~ TRUE,
      str_detect(lea, 'Limerick City North LEA') ~ TRUE,
      str_detect(lea, 'Limerick City West LEA') ~ TRUE,
      str_detect(lea, 'Ardee LEA') ~ TRUE,
      str_detect(lea, 'Dundalk-Carlingford LEA') ~ TRUE,
      str_detect(lea, 'Dundalk South LEA') ~ TRUE,
      str_detect(lea, 'Kells LEA') ~ TRUE,
      str_detect(lea, 'Trim LEA') ~ TRUE,
      str_detect(lea, 'Waterford City East LEA') ~ TRUE,
      str_detect(lea, 'Waterford City South LEA') ~ TRUE,
      str_detect(lea, 'Athlone LEA') ~ TRUE,
      str_detect(lea, 'Gorey LEA') ~ TRUE,
      str_detect(lea, 'Arklow LEA') ~ TRUE,
      str_detect(lea, 'Carlow LEA') ~ TRUE,
      str_detect(lea, 'Macroom LEA') ~ TRUE,
      str_detect(lea, 'Cobh LEA') ~ TRUE,
      str_detect(lea, 'Piltown LEA') ~ TRUE,
      str_detect(lea, 'Sligo-Strandhill LEA') ~ TRUE,
      str_detect(lea, 'Baltinglass LEA') ~ TRUE,
      str_detect(lea, 'Mallow LEA') ~ TRUE,
      str_detect(lea, 'Killarney LEA') ~ TRUE,
      str_detect(lea, 'Athy LEA') ~ TRUE,
      str_detect(lea, 'Tullamore LEA') ~ TRUE,
      str_detect(lea, 'Mullingar LEA') ~ TRUE,
      str_detect(lea, 'Bandon-Kinsale LEA') ~ TRUE,
      TRUE ~ FALSE)) 


# changing TRUE to 'RPZ' (RTZ) 
df$rent_pressure_zone <- str_replace(df$rent_pressure_zone, 'TRUE', 'RPZ')

# changing False to 'Non-RPZ' (Non RTZ) 
df$rent_pressure_zone <- str_replace(df$rent_pressure_zone, 'FALSE', 'Non-RPZ')

# assigning factor to rent_pressure_zone  variable
df$rent_pressure_zone <- as.factor(df$rent_pressure_zone)
```

```{r results='hide', echo=FALSE}
unique(df$rent_pressure_zone)
```

```{r echo=FALSE}
# examining the count of rent_pressure_zone TRUE or FALSE
df %>% 
  select(rent_pressure_zone) %>% 
  group_by(rent_pressure_zone) %>% 
  summarise(count = n())
```

### New Variable: Planning Permission
Creating a new variable 'planning_permission' in 'df' dataset to examine whether planning permission is required for the AirBnB listing. As stated above, an AirBnB listings of an entire property over 90 days in RTZ requires planning permission with the local authorites. New column will state whether planning permission is required or not. 
```{r echo=FALSE}
df <- df %>%  
  mutate(planning_permission = if_else((room_type == 'Entire rental unit' & threshold_day_90 == 'over-90' & rent_pressure_zone =='RPZ'), 'Planning Required', 'Not Required'))  
```


```{r echo=FALSE}
# examining the count of planning_permission 
df %>% 
  select(planning_permission) %>% 
  group_by(planning_permission) %>% 
  summarise(count = n())
```

### New Datasets: 'df' with 'summarise_df'
Dataset 'df' was merged with 'summarise_df' using 'listing_id' in 'available_nights_df' and 'id' in 'df'. 

```{r echo=FALSE}
# merging the dataset together
large_df<- merge(df, summarise_df, by.x = "id", by.y = "listing_id")
```

```{r}
names(large_df)
```


```{r echo=FALSE}
# dropping irrelevant columns
drop = c("id","host_id", "month", "count", "county",  "student_accomodation", "room_type","term", "threshold_day_90", "planning_permission", "rent_pressure_zone", "per_day_rent_AirBnB", "per_year_rent_AirBnB", "max_price", "mean_price", "min_price")

large_df <- large_df[names(large_df) %in% drop] 
```

```{r}
names(large_df)
```

In the final 'large_df' dataset, there are `r nrow(large_df) ` rows and `r ncol(large_df)` columns. Columns names are  `r colnames(large_df)`. 

```{r echo=FALSE}
str(large_df)
```

```{r echo=FALSE}
head(large_df)
```

```{r echo=FALSE}
summary(large_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| id | integer | AirBnB's unique identifier for the listing |
| host_id | integer | Host's unique identifier |
| month | date | Month of the year |
| min_price | integer | Minimum price for that listing in that month |
| mean_price | integer | Mean price for that listing in that month |
| max_price | integer | Maximum price for that listing in that month |
| count | integer | Number of nights available in that month |
| county | text | County of AirBnB Listing |
| student_accomodation | logical | Whether TRUE or FALSE |
| room_type | logical | Room type: Entire rental unit, Private room, Shared room |
| threshold_day_90 | text | Whether over-90 or under-90 days |
| term | text | Whether the AirBnB listing is available for long-term lease or short-term lease |
| per_day_rent_AirBnB  | text | Whether the property should be AirBnBed or rented our based on daily price |
| per_year_rent_AirBnB | text | Whether the property should be AirBnBed or rented our based on potential income |


# Final Dataset
In the final 'df' dataset, there are `r nrow(df) ` rows and `r ncol(df)` columns. Columns names are  `r colnames(df)`. 

Because our dataset was has been merged with 'available_nights_df', as described above, our dataset has AirBnB listings only available from 23rd October 2021 to 21st October 2022. Any past AirBnB are not included in our dataset. 

```{r echo=FALSE}
summary(df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| id | integer | AirBnB's unique identifier for the listing |
| name | text | Title of the property on AirBnB |
| host_id | interger | AirBnB's unique identifier for the host |
| host_name | text | Host's name |
| lea | text | Local Electoral Areas (LEAs) |
| council | text | County or City Council  |
| county | text | County of the AirBnB Listing  |
| latitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| longitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| room_type | string | Entire rental unit, Private room, Shared room, Hotel room |
| price | currency | Daily price in local currency |
| minimum_nights | integer | minimum number of night stay for the listing (calendar rules may be different) |
| number_of_reviews | integer | The number of reviews the listing has |
| last_review | date | The date of the last/newest review |
| calculated_host_listings_count | integer | The number of listings the host has in the current scrape, in the city/region geography |
| availability_365 | integer | availability_x. The availability of the listing x days in the future as determined by the calendar. Note a listing may be available because it has been booked by a guest or blocked by the host |
| number_of_reviews_ltm | integer | The number of reviews the listing has (in the last 12 months) |
| student_accomodation | logical | Whether TRUE or FALSE |
| total_income | interger | AirBnB listings potential total income (available nights * price) |
| threshold_day_90 | text | Whether over-90 or under-90 days |
| term | text | Whether the AirBnB listing is available for long-term lease or short-term lease |
| per_day_rent_AirBnB  | text | Whether the property should be AirBnBed or rented our based on daily price |
| per_year_rent_AirBnB | text | Whether the property should be AirBnBed or rented our based on potential income |


# Data Visualisation
```{r echo=FALSE}
# assigning colors to specific variable 
# will be used in graphs to ensure that the colours remain the same.
# creates association with colour and variables

#RPZ or Non-RPZ
pressure_colors = c( "#316395", "#D62728")

#entire rental unit, private room, shared room
room_colors = c('#54A24B', '#72B7B2', '#B279A2')

# rent or AirBnB
rent_colors = c('#565656', '#F58518')

#over-90 or under-90
threshold_colors = c('#FF9DA6', '#72B7B2')


# availability
reverse_viridis = c( "#FDE725FF",
                     '#B8DE29FF',
                     '#73D055FF',
                     '#29AF7FFF',
                     '#1F968BFF',
                     '#2D708EFF',
                     '#39568CFF',
                     '#482677FF',
                     "#440154FF")
```

## AirBnB OverView
```{r echo=FALSE, warning=FALSE}
# creating a map of Ireland with AirBnB listings
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(df, lat = ~latitude, lon = ~longitude, color = ~county)
fig <- fig %>% add_markers(marker = list(opacity = 0.4), showlegend = FALSE,
                
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights))
fig <- fig %>% layout(
    title = 'Where are the AirBnB listings in Ireland?', geo = g)

fig
```
**Comment:**
It is clear from this graph that there are some parts of Ireland that have more AirBnB listings than others. It is easy to see that there are more properties available on the coast than inland. 


### Room Types are available on AirBnB
```{r warning=FALSE, echo=FALSE}
df %>%
  count(room_type) %>%
  mutate(room_type = fct_reorder(room_type, n, .desc = TRUE)) %>%
  plot_ly(x = ~room_type, y = ~n, color = ~room_type,
          hovertemplate = ~paste("Room Type:", room_type, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title= 'What Accomodation Types are available on AirBnB  in Ireland?')
```

### Where are the AirBnB listings in Ireland?
```{r warning=FALSE, echo=FALSE}
df %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          
          hovertemplate = ~paste("County:", county, "<br>", "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title= 'Which counties have the most AirBnB listings in Ireland?')
```
**Comment:**
It was surprising to see that Kerry has more AirBnB listings available than Dublin. It is also important to note that the first seven in the table (except for Dublin) are all on the Wild Atlantic Way. 

### Summary of AirBnB listings
```{r echo=FALSE}
# examining the mean and the max or price for each county
df %>% 
  select(county, price, minimum_nights) %>% 
  group_by(county) %>% 
  summarise(no_of_listings = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights)) %>% 
  arrange(desc(no_of_listings))

```
**Comment:**
Even though Kerry has more options for accomondation than Dublin, it is also more expensive. 

### When are most AirBnB listings Available?
```{r echo=FALSE, warning=FALSE}
# creating a dataset of the table above
sum_df <- summarise_df %>% 
  select(listing_id, month) %>% 
  group_by(month) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(listing_id))


sum_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~month,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = "When are the most AirBnB listings Available?")
```
**Comment:**
There are less AirBnB listings available in the summer, than the winter. However, it is possible that the AirBnB listings are not yet for the summer.

### Breakdown by County
```{r warning=FALSE, echo=FALSE}
df %>%
  count(room_type, county) %>%
  mutate(room_type = fct_reorder(room_type, n, .desc = TRUE)) %>%
  plot_ly(x = ~room_type, y = ~n, color = ~room_type,
          hovertemplate = ~paste("County:", county, "<br>", "Accomodation Type:", room_type, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE,  frame = ~county) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = "What type of accomodation is most common in each county?")
```
**Comment:**
By clicking on different counties, it is possible to see the difference between counties on types of accommodation available.  Dublin has more private rooms available than entire rental units. However, in Galway and Cork, there are more entire rental units available than private rooms. 

```{r warning=FALSE, echo=FALSE}
df %>%
  plot_ly(x = ~room_type, y = ~price, color = ~room_type) %>%
  add_boxplot(frame = ~county, showlegend = FALSE) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title="What is the price of each type of accomodation for each county?",
    boxmode = "group") 
```

**Comment:**
It is possible to select the same county in the two graphs above and compare. For example, Dublin has more entire rental units than private rooms, entire rental units are more expensive than private rooms. 


```{r echo=FALSE, warning=FALSE}
# creating a dataset of the table above
sum_month_df <- large_df %>% 
  select(id, month, county) %>% 
  group_by(month, county) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

sum_month_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~month,
          hovertemplate = ~paste("County:", county, "<br>", "Month:", month, "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~county, showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = "When are the most AirBnB listings Available?")
```
**Comment:**
It is interesting to compare AirBnB listings for each month and county. Big cities like Dublin, Cork, Galway and Limerick, including Kerry, have less AirBnB listings in teh summer. It is unclear why this is the case, considering more tourists come to Ireland during the summer. 

### Conclusion
The initial examination of the data, shows that there are more AirBnB Listing in Kerry than Dublin. Top 7 county with AirBnB listings  are on the Wild Atlantic Way. The map of Ireland shows the density of the number of listings on the coast. For some reason, there are less AirBnB listings in the summer than the winter. Number of room types differs depedning on the county. Dublin City, Cork City and Galway City,   The county breakdown examination shows no difference in price or mininum nights required to stay regardless of room type. 


## RPZ
```{r echo=FALSE, warning=FALSE}
# creating a map of Ireland with AirBnB listings in RTZ differentiated 
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(df, lat = ~latitude, lon = ~longitude, color = ~rent_pressure_zone)
fig <- fig %>% add_markers(marker = list(opacity = 0.2), showlegend=FALSE, colors = pressure_colors,
                          
                          hovertemplate = ~paste("LEA:", lea, "<br>", 
                                        "Council:", council, "<br>",
                                        "Price (in €):", price, "<br>",
                                        "Room Type", room_type, "<br>",
                                        "Mininum stay (in nights)", minimum_nights, "<br>",
                                        "Availability (in nights)", available_nights, "<br>",
                                        "RTZ", rent_pressure_zone, "<br>",
                                        "Student Accomodation:",student_accomodation))
fig <- fig %>% layout(
    title = 'Which AirBnB listings are in the RTZs?', geo = g)

fig
```

**Comment:**
Map of Ireland represents the density of AirBnB listings, highlighting the areas that are in RTZs (in red). Athough Dublin City, Cork City and Galway City are all in RTZs, it is possible to see the huge amount of AirBnB listings available, which can be affecting the Irish Housing Crisis.  

### Summary of RTZs
```{r message=FALSE, echo=FALSE}
# creating a dataframe with rent_pressure_zone and room_type, arranging by count
df %>% 
  select(rent_pressure_zone, room_type, price, minimum_nights) %>% 
  group_by(room_type, rent_pressure_zone) %>% 
  summarise(count = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights)) 
```

**Comment:**
There are more entire rental units and private rooms available outside of RTZs than there are in the RTZs. 

### Breakdown of AirBnB listings by Accomodation Type and RPZ
```{r echo=FALSE}
df %>%
  count(rent_pressure_zone, room_type) %>%
  mutate(room_type = fct_reorder(room_type, n, .desc = TRUE)) %>%
  plot_ly(x = ~room_type, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("RTZ:", rent_pressure_zone, "<br>",
                        "Accomodation Type:", room_type, "<br>", 
                        "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title='What Room Types are available <br> inside and outside RTZs?')
   
```
**Comment:**
Table above is summarised with this graph. There are more entire rental units and private rooms available outside of RTZs than there are in the RTZs. However, this could be due to fact that there are more houses in general outside the RTZs than inside the RTZs, which would show more AirBnB listings outside RTZs than inside RTZs.

### Breakdown of Price by: Room Type and non-/RTZ
```{r warning=FALSE, echo=FALSE}
df %>%
  plot_ly(x = ~room_type, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(marker = list(opacity = 0.2), showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title="What rooom type is cheaper <br> inside or outside of RTZs",
    boxmode = "group") 
   
```
**Comment:**
Although, there is a difference between entire rental unit and private/shared room on price, there is no big difference between renting private/shared room inside or outside the RTZ. However, an entire rental unit is slightly more expensive in RTZs than outside RTZs. 


```{r echo=FALSE, warning=FALSE}
# eamining the number of AirBnB listings available in each month
large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  summarize(count_distinct = n_distinct(id))
```
**Comment:**
In the table above, number of listings is summarised by RTZ and month. 

```{r echo=FALSE, warning=FALSE}
# creating a dataset of the table above
sum_rpz_df <- large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

sum_rpz_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~rent_pressure_zone,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "RTZ:", rent_pressure_zone , "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~rent_pressure_zone, showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = "When are the most AirBnB listings Available <br> in RTZ?")
```
**Comment:**
In the graph above visusalises the table above. As seen above, there are overall less AirBnB listings in RTZs than in Non-RTZs. Furthermore, the trend follows for the month: less AirBnBs are available during the summer than in the winter. 

### RPZ: Conclusion
Map of Ireland shows that there are a lot of AirBnB listings in RTZs, which would affect the number of accommodation available for the housing market, to buy or to rent. There are as many entire rental units as private rooms in RTZs. There are more entire rental units outside of RTZs because there are more areas not in RTZs than there are in RTZs. At first glance, due to the amount of AirBnB listings in RTZs, it could be argued to the government that it could potentially reduce the pressure on the Irish housing market and reduce the Housing Crisis in RTZs.  

## Entire Rental Unit
A new dataset was created where AirBnB listings were selected that offered entire rental unit.  This new dataset was used for this section of the report.  
```{r echo=FALSE}
# create new dataset where filtered by 'Entire rental unit'
entire <-  df %>% 
  filter(room_type =='Entire rental unit')
```


```{r echo=FALSE, warning=FALSE}
# creating a map of Ireland with AirBnB listings in RTZ differentiated 
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(entire, lat = ~latitude, lon = ~longitude, color = ~rent_pressure_zone)
fig <- fig %>% add_markers(marker = list(opacity = 0.2), showlegend=FALSE, colors = pressure_colors,
                          
                          hovertemplate = ~paste("LEA:", lea, "<br>", 
                                        "Council:", council, "<br>",
                                        "Price (in €):", price, "<br>",
                                        "Room Type", room_type, "<br>",
                                        "Mininum stay (in nights)", minimum_nights, "<br>",
                                        "Availability (in nights)", available_nights, "<br>",
                                        "RTZ", rent_pressure_zone, "<br>",
                                        "Student Accomodation:",student_accomodation))
fig <- fig %>% layout(
    title = 'Where are Entire Rental Units in the RTZs?', geo = g)

fig
```


### Summary of Entire Rental Units
```{r echo=FALSE}
# examining the mean and the max or price for each county for Entire House
entire %>% 
  select(county, price, minimum_nights) %>% 
  group_by(county) %>% 
  summarise(no_of_listings_entire_house_apt = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights)) %>% 
  arrange(desc(no_of_listings_entire_house_apt))

```


### Entire Rental Units by County
```{r echo=FALSE, fig.align = 'center',  warning=FALSE, message=FALSE}
entire %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          hovertemplate = ~paste("County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"), 
         barmode = 'stack',
         title='Where are the most AirBnB Listings of Entire Rental Units?')
```
**Comment:**
Kerry and Donegal have more entire rental units than other counties. Dublin is only 5th highest, while Cork and Galway are in 3rd and 4th place.

### Summary of Entire Rental Units by Counties
```{r warning=FALSE, echo=FALSE}
# examining the mean and the max or price for each county 
entire %>% 
  select(county) %>% 
  group_by(county) %>% 
  summarise(no_of_listings_entire_rental_unit = n()) %>% 
  arrange(desc(no_of_listings_entire_rental_unit))

```

### Counties by RTZs
```{r echo=FALSE}
entire %>%
  select(rent_pressure_zone, county) %>% 
  count(county, rent_pressure_zone) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~rent_pressure_zone,
          hovertemplate = ~paste("County:", county, "<br>", "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"), 
         barmode = 'stack',
         title='What counties have the entire rental units in RTZs?')
```
**Comment:**
When Kerry was examined, 326 AirBnB listings are in the RTZ, while the rest is outside the RTZ. Both County Galway and County Cork have AirBnB listings in RTZ and outside of it.  All Dublin City AirBnBlistings, Cork City AirBnB listings and Galway City AirBnB listings is in the RTZ.  

### Summary of Counties by RTZs
```{r warning=FALSE, echo=FALSE}
# examining the mean and the max or price for each county and rent_pressure_zone
entire %>% 
  select(county, rent_pressure_zone, price) %>% 
  group_by(county, rent_pressure_zone) %>% 
  summarise(no_of_listings_entire_rental_unit = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price)) %>% 
  arrange(desc(mean_price))

```

### Price by County and RPZ
```{r warning=FALSE, echo=FALSE}
entire %>%
  plot_ly(x = ~rent_pressure_zone, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(frame = ~county,showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title="Where is the Cheapest Entire Rental Unit on AirBnB <br> based on County and RPZ?",
    boxmode = "group") 
```

### Mininum Nights by County and RPZ
```{r warning=FALSE, echo=FALSE}
entire %>%
  plot_ly(x = ~rent_pressure_zone, y = ~minimum_nights, color = ~rent_pressure_zone) %>%
  add_boxplot(frame = ~county,showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Mininum Nights per Stay",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 15)),
    title='What is the Shortest Possible Stay for Entire Rental Unit on AirBnB <br> based on County and RPZ?')
```


### Availability

```{r echo=FALSE, warning=FALSE}
# creating a map of Ireland with AirBnB entire rental units listings in RTZ 

g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(entire, lat = ~latitude, lon = ~longitude, color = ~available_nights)
fig <- fig %>% add_markers(marker = list(opacity = 0.4), 
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_year_rent_AirBnB))
fig <- fig %>% layout(
    title = 'What is the availability for each AirBnB listing?', geo = g)

fig
```
**Comment:**  
It is visible that a lot of properties are not available all year around. Unfortunately, no reason is provided why the property is unavailable. 

### Time of Year by RTZs
```{r echo=FALSE}
# create new dataset where filtered by 'Entire rental unit'
entire_large_df <-  large_df %>% 
  filter(room_type =='Entire rental unit')
```

```{r echo=FALSE, warning=FALSE}
# eamining the number of AirBnB listings available in each month
entire_large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  summarize(count_distinct = n_distinct(id))
```
**Comment:**
In the table above, number of listings of entire rental units is summarised by RTZ and month. 

```{r echo=FALSE, warning=FALSE}
# creating a dataset of the table above
entire_sum_rpz_df <- entire_large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

entire_sum_rpz_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~rent_pressure_zone,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "RTZ:", rent_pressure_zone , "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~rent_pressure_zone, showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title = "When are the most Entire Rental Units AirBnB listings Available <br> in RTZ?")
```
**Comment:**  
This graph shows less entire rental units available during summer months in RTZs and Non-RTZs. It is still unclear why. 

### Profitablity PER DAY
```{r echo=FALSE, warning=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(entire, lat = ~latitude, lon = ~longitude, color = ~per_day_rent_AirBnB)
fig <- fig %>% add_markers(marker = list(opacity = 0.4),colors = rent_colors,
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_day_rent_AirBnB))
fig <- fig %>% layout(
    title = 'Which Entire Rental Units should be rented out? <br> Profitability PER DAY', geo = g)

fig
```
**Comment:**
When comparing daily rent rate and daily AirBnB, for most properties, it is more profitable to AirBnB.

```{r message=FALSE, echo=FALSE}
entire %>% 
  select(rent_pressure_zone, per_day_rent_AirBnB, minimum_nights, price) %>% 
  group_by(rent_pressure_zone, per_day_rent_AirBnB) %>% 
  summarise(no_of_listings = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights))
  
```
**Comment:**
The table above the shows the breakdown of which entire rental units should be rented out or  leased out as AirBnB, when only the daily price and daily rent rate is to be considered. 

### Profitablity PER YEAR
```{r echo=FALSE, warning=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(entire, lat = ~latitude, lon = ~longitude, color = ~per_year_rent_AirBnB)
fig <- fig %>% add_markers(marker = list(opacity = 0.4),colors = rent_colors,
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", total_income, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_year_rent_AirBnB))
fig <- fig %>% layout(
    title = 'Which Entire Rental Units should be rented out? <br> Profitability PER YEAR', geo = g)

fig
```
**Comment:**
However, when comparing total potential income (available nights * price) and annual income (rent_in_ireland.csv  * 12), it seems that most landlords are missing out on the potential annual rent. THis could be due to the fact that the rental unit is not available all year around. 

```{r message=FALSE, echo=FALSE}
entire %>% 
  select(rent_pressure_zone, per_year_rent_AirBnB, minimum_nights, price, total_income) %>% 
  group_by(rent_pressure_zone, per_year_rent_AirBnB) %>% 
  summarise(no_of_listings = n(),
            min_price = min(total_income), 
            median_price = median(total_income), 
            mean_price = mean(total_income),
            max_price = max(total_income))
  
```
**Comment:**
The table above the shows the breakdown of which entire rental units should be rented out or  leased out as AirBnB, when only the daily price and daily rent rate is to be considered. 

### Threshold Examinination
As previously stated, homeowners in RTZs (RPZs) are required to apply for planning permission if they let out their entire home (principal private residence) for short-term lets of more than 90 days in total while they are away. Principal private residence is the place where one ordinarily live.

```{r echo=FALSE}
entire %>%
  count(rent_pressure_zone, threshold_day_90, planning_permission) %>%
  mutate(threshold_day_90 = fct_reorder(threshold_day_90, n, .desc = TRUE)) %>%
  plot_ly(x = ~threshold_day_90, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("RTZ:", rent_pressure_zone, "<br>",
                        "Threshhold:", threshold_day_90, "<br>", 
                        "Number of AirBnB listings:", n,"<br>", 
                        "Planning Required:", planning_permission)) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title='AirBnB listings by Threshold and RTZ')
   
```
**Comment:**
There are very small amount of properties in the Rent Pressures Zones that are over 90 day threshold that would require planning permission. 

```{r message=FALSE, echo=FALSE}
entire %>% 
  select(rent_pressure_zone, threshold_day_90,planning_permission, minimum_nights, price) %>% 
  group_by(rent_pressure_zone, threshold_day_90, planning_permission) %>% 
  summarise(no_of_listings = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights))
  
```
**Comment:**
Summary of the graph above, there are very small amount of properties in the Rent Pressures Zones that are over 90 day threshold that would require planning permission. 

### Stay Duration
```{r echo=FALSE}
entire %>%
  count(rent_pressure_zone, term) %>%
  mutate(term = fct_reorder(term, n, .desc = TRUE)) %>%
  plot_ly(x = ~term, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("RTZ:", rent_pressure_zone, "<br>",
                        "Term:", term, "<br>", 
                        "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title='AirBnB listings by Lease Term and RTZ')
   
```

```{r message=FALSE, echo=FALSE}
entire %>% 
  select(rent_pressure_zone, term, minimum_nights, price) %>% 
  group_by(rent_pressure_zone, term) %>% 
  summarise(no_of_listings = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights))
  
```

### Term by RTZs
```{r warning=FALSE, echo=FALSE}

 entire %>%
  plot_ly(x = ~term, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title="Entire Rental Unit AirBnB listings by Term and RTZ",
    boxmode = "group") 

```
**Comment:**
Entire rental units available in RTZs are more expensive than outside of RTZs. There is a slight difference between price between short-term lease and long-term lease.    

### Mininum Nights by Term and RTZs
```{r warning=FALSE, echo=FALSE}

entire %>%
  plot_ly(x = ~term, y = ~minimum_nights, color = ~rent_pressure_zone) %>%
  add_boxplot(showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Mininum Nights per Stay",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         title="Mininum Nights for Entire Rental Unit AirBnB listings <br> by Term and RTZ",
         range = list(0, 100)),
    boxmode = "group") 

``` 
**Comment:**
There seems to be a difference in mininum nights to stay in Entire rental units available in RTZs are more expensive than outside of RTZs. Short-term lease is up to 15 days, so that is why is very small window of stay. 

### Entire Rental Unit: Conclusion 
There is more entire rental units in Kerry than in other places in Ireland. When availability was examined, it was clear that not all entire rental units were available all year around. When examining the months of year, it is clear that there are less entire rental units available in the summer than other times of the year. It is unclear why this occurs and what is the landlord's motivation behind this. Majority of stays of entire rental units are available for short-term stays (mininum nights under 14 days) and availability for the year is below 90 days. In RTZs, there are only 2,356 properties that require planning permission (availability over 90 days in the year and in RTZs). This would mean that there are over 2,000 properties that could be placed into long-term rental market to ease the Housing Crisis in Ireland. Analysis of potential income from rent vs AirBnB shows that most of the AirBnB earn less than the potential rental annual income. Of course, this is because most entire rental units on AirBnB are not available all year around, motivation for this is unclear.

## Private Room
A new dataset was created where AirBnB listings were selected that offered private rooms in a shared house. This new dataset was used for this section of the report.  
```{r echo=FALSE}
# create new dataset where filtered by 'Private Room'
private_room <-  df %>% 
  filter(room_type =='Private room')

```

```{r echo=FALSE, warning=FALSE}
# creating a map of Ireland with AirBnB listings in RTZ differentiated 
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(private_room, lat = ~latitude, lon = ~longitude, color = ~rent_pressure_zone)
fig <- fig %>% add_markers(marker = list(opacity = 0.2), showlegend=FALSE, colors = pressure_colors,
                          
                          hovertemplate = ~paste("LEA:", lea, "<br>", 
                                        "Council:", council, "<br>",
                                        "Price (in €):", price, "<br>",
                                        "Room Type", room_type, "<br>",
                                        "Mininum stay (in nights)", minimum_nights, "<br>",
                                        "Availability (in nights)", available_nights, "<br>",
                                        "RTZ", rent_pressure_zone, "<br>",
                                        "Student Accomodation:",student_accomodation))
fig <- fig %>% layout(
    title = 'Where are Private Rooms in the RTZs?', geo = g)

fig
```

### Summary of Private Rooms
```{r echo=FALSE}
# examining the mean and the max or price for each county for Entire House
private_room %>% 
  select(county, price, minimum_nights) %>% 
  group_by(county) %>% 
  summarise(no_of_listings_private_room = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights)) %>% 
  arrange(desc(no_of_listings_private_room))

```

### Private Rooms by County
```{r echo=FALSE, fig.align = 'center',  warning=FALSE, message=FALSE}
private_room %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          hovertemplate = ~paste("County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"), 
         barmode = 'stack',
         title='Where are the most AirBnB Listings of Private Rooms?')
```

```{r warning=FALSE, echo=FALSE}
# examining the mean and the max or price for each county 
private_room %>% 
  select(county) %>% 
  group_by(county) %>% 
  summarise(no_of_listings_entire_rental_unit = n()) %>% 
  arrange(desc(no_of_listings_entire_rental_unit))

```

### Breakdown of Private Room AirBnB listings by County and RPZ
```{r echo=FALSE}
private_room %>%
  count(rent_pressure_zone, county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~rent_pressure_zone,
          hovertemplate = ~paste("County:", county, "<br>", 
                                 "RTZ:", rent_pressure_zone, "<br>",
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"), 
         barmode = 'stack',
         title='Private Room AirBnB listings by County and RPZ')
```
**Comment:**
Dublin has the most number of private rooms available, all of which are in the RTZ. However, the next three in the RTZ are: Kerry, Cork City and Galway City. 

### Price by RPZ and County
```{r warning=FALSE, echo=FALSE}
private_room %>%
  plot_ly(x = ~rent_pressure_zone, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(frame = ~county,showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title="Breakdown of Price of Private Room AirBnB listings by RPZ and County",
    boxmode = "group") 
```
**Comment:**
There are no visible difference between prices of private room AirBnB listings regardless of whether the AirBnB is in RTZ or County.

### Minimum Nights by RPZ and County
```{r warning=FALSE, echo=FALSE}
private_room %>%
  plot_ly(x = ~rent_pressure_zone, y = ~minimum_nights, color = ~rent_pressure_zone) %>%
  add_boxplot(frame = ~county,showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Mininum Nights per Stay",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         itle="Breakdown of Mininum Nights of Private Room AirBnB listings by RPZ and County",
         range = list(0, 15)))
```
**Comment:**
There are no visible difference between minimum nights required to stay in private room AirBnB listings regardless of whether the AirBnB is in RTZ or County.

### Profitability PER DAY
```{r echo=FALSE, warning=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(private_room, lat = ~latitude, lon = ~longitude, color = ~per_day_rent_AirBnB)
fig <- fig %>% add_markers(marker = list(opacity = 0.4), showlegend = FALSE, colors = rent_colors,
                
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_day_rent_AirBnB))
fig <- fig %>% layout(
    title = 'Which Private Rooms should be rented out?', geo = g)

fig
```
**Comment:**
When comparing daily rent rate and daily AirBnB, for most properties, it is more profitable to AirBnB.

```{r message=FALSE, echo=FALSE}
private_room %>% 
  select(rent_pressure_zone, per_day_rent_AirBnB, minimum_nights, price) %>% 
  group_by(per_day_rent_AirBnB, rent_pressure_zone) %>% 
  summarise(no_of_listings = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights))
  
```

### Profitability PER YEAR
```{r echo=FALSE, warning=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(private_room, lat = ~latitude, lon = ~longitude, color = ~per_year_rent_AirBnB)
fig <- fig %>% add_markers(marker = list(opacity = 0.4), showlegend = FALSE, colors = rent_colors,
                
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_year_rent_AirBnB))
fig <- fig %>% layout(
    title = 'Which Private Rooms should be rented out?', geo = g)

fig
```
**Comment:**
However, when comparing total potential income (available nights * price) and annual income (rent_in_ireland.csv  * 12), it seems that most landlords are missing out on the potential annual rent. THis could be due to the fact that the rental unit is not available all year around. 

```{r message=FALSE, echo=FALSE}
private_room %>% 
  select(rent_pressure_zone, per_year_rent_AirBnB, minimum_nights, price) %>% 
  group_by(per_year_rent_AirBnB, rent_pressure_zone) %>% 
  summarise(no_of_listings = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights))
  
```

### Availability
```{r echo=FALSE, warning=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(private_room, lat = ~latitude, lon = ~longitude, color = ~available_nights)
fig <- fig %>% add_markers(marker = list(opacity = 0.4),
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", available_nights, "<br>",
                        "To Rent or To Buy:",per_year_rent_AirBnB))
fig <- fig %>% layout(
    title = 'Availability for Private Room', geo = g)

fig
```
**Comment:**
Above Map of Ireland, shows the availability of private rooms. It seems that there are a lot of private rooms that are not available all year around.  


### Time of Year by RTZs 
```{r echo=FALSE}
# create new dataset where filtered by 'Entire rental unit'
private_large_df <-  large_df %>% 
  filter(room_type =='Private room')
```

```{r echo=FALSE, warning=FALSE}
# creating a dataset of the table above
private_sum_rpz_df <- private_large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  #conting distinct AirBnB listing's id
  summarize(count_distinct = n_distinct(id))

private_sum_rpz_df %>%
  plot_ly(x = ~month, y = ~count_distinct, color = ~rent_pressure_zone,
          hovertemplate = ~paste("Month:", month, "<br>", 
                                 "RTZ:", rent_pressure_zone , "<br>", 
                                 "Number of AirBnB listings:", count_distinct)) %>%
  add_bars(frame = ~rent_pressure_zone, showlegend = FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
        yaxis = list(title = "Number of AirBnB listings"),
        title = "When are the most Private Room AirBnB listings Available <br> in RTZs?")
```
**Comment:**
The graph above shows that regardless of RTZs, there are still less availability during the summer than winter. 

```{r echo=FALSE, warning=FALSE}
# eamining the number of AirBnB listings available in each month
private_large_df %>% 
  select(id, month, rent_pressure_zone) %>% 
  group_by(month, rent_pressure_zone) %>% 
  summarize(count_distinct = n_distinct(id))
```
**Comment:**
In the table above, number of listings of private rooms is summarised by RTZ and month. A table of above illustration. 

### Private Room by RTZ and Threshold (under/over 90 days)
As previously stated, homeowners in RTZs (RPZs) are required to apply for planning permission if they let out their entire home (principal private residence) for short-term lets of more than 90 days in total while they are away. Principal private residence is the place where one ordinarily live. However, there is no threshold for private rooms. It is still interesting to examine this relationship

```{r echo=FALSE}
private_room %>%
  count(rent_pressure_zone, threshold_day_90) %>%
  mutate(threshold_day_90 = fct_reorder(threshold_day_90, n, .desc = TRUE)) %>%
  plot_ly(x = ~threshold_day_90, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("RTZ:", rent_pressure_zone, "<br>",
                        "Threshhold:", threshold_day_90, "<br>", 
                        "Number of AirBnB listings:", n,"<br>")) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title='AirBnB listings by Threshold and RTZ')
   
```
**Comment:**
There are 2,124 private rooms that are available over 90 days in RTZs. If the same rules were applied to private rooms as entire rental units, then these properties would require planning permission. 

### Stay Duration
```{r echo=FALSE}
private_room %>%
  count(rent_pressure_zone, term) %>%
  mutate(term = fct_reorder(term, n, .desc = TRUE)) %>%
  plot_ly(x = ~term, y = ~n, color = ~rent_pressure_zone,
          
          hovertemplate = ~paste("RTZ:", rent_pressure_zone, "<br>",
                        "Term:", term, "<br>", 
                        "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend=FALSE, colors = pressure_colors) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
         title='Private Room AirBnB listings <br> by Lease Term and RTZ')
   
```

```{r message=FALSE, echo=FALSE}
private_room %>% 
  select(rent_pressure_zone, term, minimum_nights, price) %>% 
  group_by(rent_pressure_zone, term) %>% 
  summarise(no_of_listings = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights))
  
```

### Price by Term and RTZs
```{r warning=FALSE, echo=FALSE}

private_room %>%
  plot_ly(x = ~term, y = ~price, color = ~rent_pressure_zone) %>%
  add_boxplot(showlegend = FALSE, colors = pressure_colors) %>% 
  layout(
    xaxis = list(title = FALSE),
    yaxis = list(title = "Price in Euro",
         zerolinecolor = '#ffff',
         zerolinewidth = 2,
         gridcolor = 'ffff',
         range = list(0, 450)), 
         title="What Private Room are cheaper: by Term and RTZs?",
    boxmode = "group") 

```
**Comment:**
There are absolutely no difference between private room listings inside and outside RTZs and term type (under/over-90). This means that regardless of nights stayed in RTZs, the price is very similar. 

### Private Room: Conclusion
In a lot of counties, there are as many private rooms as there are entire rental units. Dublin has the most number of private rooms, all of which are in the RTZ.
There are no planning permission required for long-term stays in RTZs with availability for over-90 days. In RTZs, there are only 3,011 private rooms available on AirBnB, while there are 3,152 private rooms outside RTZs. Most of the properties in Rent Pressure could be placed into long-term rental market to ease the Housing Crisis in Ireland. Analysis of potential income from rent vs AirBnB shows that most of the AirBnB earn less than the potential rental annual income. Of course, this is because most entire rental units on AirBnB are not available all year around, motivation for this is unclear.


There are 2,124 private rooms that are available over 90 days in RTZs. If the same rules were applied to private rooms as entire rental units, then these properties would require planning permission. Identifying this should help lobbyists of change to regulations to include private rooms in their cut-offs.  

## Top 5 Hosts with the most listings on AirBnB in RTZs
A new dataset was created where 5 AirBnB hosts with the most properties were selected.  This new dataset was used for this section of the report.  

### Summary of Top AirBnB Hosts
```{r echo=FALSE}
# displaying the hosts with the most listings on AirBnB
df %>% 
  select(rent_pressure_zone, host_id, host_name, price,minimum_nights) %>% 
  filter(rent_pressure_zone == 'RPZ') %>% 
  group_by(host_id, host_name) %>% 
  summarise(count = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights)) %>% 
  arrange(desc(count)) 
```
**Comment:**
Table above examines the AirBnB listings by counting the number of listings in RTZs for each host, ordering it in ascending order. One hosts has over 200 AirBnB listings. 

```{r message=FALSE, echo=FALSE}
# creating a dataframe with host_id and count, arranging by count
rpz_top_hosts <-  df %>% 
  select(rent_pressure_zone, host_id, host_name) %>% 
  filter(rent_pressure_zone == 'RPZ') %>% 
  group_by(host_id) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  # get all hosts with more than 10 properties on AirBnB
  filter( count > 10)
```

```{r echo=FALSE}

rpz_df <-  df %>% 
  filter(rent_pressure_zone == 'RPZ')

# creating a list of the top 5 hosts using host_id
rpz_top_hosts_list <- c(rpz_top_hosts$host_id)

# creating a new dataframe that only selects host_in in Top 20 hosts
rpz_top_df <- rpz_df %>% 
  filter(host_id %in% rpz_top_hosts_list)
```

### Location of Properties owned by Top AirBnB listings
```{r warning=FALSE, echo=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(rpz_top_df, lat = ~latitude, lon = ~longitude, color = ~host_name)
fig <- fig %>% add_markers(
                            hovertemplate = ~paste("Host ID:", host_id, "<br>", 
                                                   "Host Name:", host_name, "<br>", 
                                                   "County:", county, "<br>", 
                                                  "Price (in €):", price, "<br>",
                                                  "Room Type", room_type, "<br>",
                                                  "RTZs", rent_pressure_zone, "<br>",
                                                  "Mininum stay (in nights)", minimum_nights, "<br>",
                                                  "Availability (in nights)", available_nights, "<br>"))
fig <- fig %>% layout(
    title = 'Top Hosts with the Most AirBnB listings in RTZ', geo = g)

fig
```
**Comment:**
Map of Ireland examines the location of AirBnB listings in RTZs for those Top hosts.  By double clicking on the id in the legend, it possible to just select one host and examine the location of their AirBnBs in RTZs. Some hosts has several AirBnB listings in different counties. It is unclear how they manage their properties for AirBnB.  

### Room Type in Top Hosts in RTZs by County
```{r warning=FALSE, echo=FALSE}
rpz_top_df %>%
  count(room_type, county) %>%
  mutate(room_type = fct_reorder(room_type, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          hovertemplate = ~paste("Accomodation Type:", room_type, "<br>", 
                                 "County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE,  frame = ~room_type) %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
          title = "What is the breakdown by Top Hosts properties in RTZ <br> by room type and County?")
```
**Comment:**
Dublin City has the most AirBnB hosts with properties regardless of room type. There are also more private rooms than entire rental units. Galway City and Cork City also have hosts that have many AirBnB listings. However, there are more entire rental units than private rooms in those cities.

### Top Hosts: Conclusion
There are individuals who hold a lot of property in RTZs. It is unclear how those individuals manage their properties around Ireland. It could be suggested that having too many properties on AirBnB should be part of planning permission. This would allow landlords to have constant tenants and not worry about managing their AirBnB properties around Ireland.  

## Student Accomodation
A new dataset was created where AirBnB listings were selected that offered student accommodation.  This new dataset was used for this section of the report.  

```{r echo=FALSE}
 df %>% 
  select(student_accomodation) %>% 
  group_by(student_accomodation) %>% 
  summarise(count = n()) 
```

### Summary of Student Accomodation
```{r echo=FALSE}
student_df <- df %>% 
  filter(student_accomodation == TRUE)
```

```{r echo=FALSE}
student_df %>% 
  select(county, price, minimum_nights) %>% 
  group_by(county) %>% 
  summarise(count = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights)) %>% 
  arrange(desc(count))

```
**Comment:**
Table above shows the summary of accomodation for students by county. Galway City and Cork City have the highest mean rates, even higher than Dublin.  

### AirBnB listings targetting Students by County
```{r warning=FALSE, echo=FALSE}
student_df %>%
  count(county) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~county, y = ~n, color = ~county,
          
          hovertemplate = ~paste("County:", county, "<br>", "Number of AirBnB listings:", n)) %>%
  add_bars() %>%
  layout(xaxis = list(title = "County"),
          yaxis = list(title = "Number of AirBnB listings per County"),
          title = "Where are AirBnB listings targetting Students?")
```
**Comment:**
Although Galway City and Cork City are the most expensive for student accommodation, there is still more listings for Dublin City. There is only one Clare listing targetting students 

### AirBnB hosts that taget students
```{r echo=FALSE}
student_df %>% 
  select(host_id) %>% 
  group_by(host_id) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))

```
**Comment:**
AirBnB listings, that contain 'student' in name/description, have property in Dublin City, Cork City and Galway City. 

```{r warning=FALSE, echo=FALSE}
# geo styling
g <- list(
  scope = 'europe',
  showland = TRUE,
  landcolor = toRGB("gray95"),
  subunitcolor = toRGB("gray85"),
  countrycolor = toRGB("gray85"),
  countrywidth = 0.5,
  subunitwidth = 0.5,

  resolution = 50,
  lonaxis = list(range = c(-12, -5)),
  lataxis = list(range = c(52, 55))
)

fig <- plot_geo(student_df, lat = ~latitude, lon = ~longitude, color = ~host_id,
                
                hovertemplate = ~paste("County:", county, "<br>", 
                        "Price (in €):", price, "<br>",
                        "Room Type", room_type, "<br>",
                        "Mininum stay (in nights)", minimum_nights, "<br>",
                        "Availability (in nights)", availability_365, "<br>",
                        "Student Accomodation:",student_accomodation))
fig <- fig %>% add_markers()
fig <- fig %>% layout(
    title = 'Location of properties Targetting Students', geo = g)

fig
```
**Comment:**
By double clicking on the host_id in the legend, it is clear tha the host with host_id '226804666' has property in Dublin, Cork and Galway. 

### Type of Accomodation available to Students
```{r warning=FALSE, echo=FALSE}
student_df %>%
  count(county, room_type) %>%
  mutate(county = fct_reorder(county, n, .desc = TRUE)) %>%
  plot_ly(x = ~room_type, y = ~n, color = ~county,
          
          hovertemplate = ~paste("Accomodation Type:", room_type, "<br>", 
                                 "County:", county, "<br>", 
                                 "Number of AirBnB listings:", n)) %>%
  add_bars() %>%
  layout(xaxis = list(title = FALSE),
          yaxis = list(title = "Number of AirBnB listings"),
          title = "What is the accomodation type for AirBnB listings targetting students?")
```
**Comment:**
There are 176 private rooms available in Dublin, comparing to four entire rental units targeting students in Dublin. Cork City and Galway City have more private rooms than entire renal units.

```{r warning=FALSE, echo=FALSE} 
student_df %>% 
  select(county, room_type, price, minimum_nights) %>% 
  group_by(room_type, county) %>% 
  summarise(count = n(),
            min_price = min(price), 
            median_price = median(price), 
            mean_price = mean(price),
            max_price = max(price),
            min_nights = min(minimum_nights), 
            median_min_nights = median(minimum_nights),
            mean_min_nights = mean(minimum_nights),
            max_min_nights = max(minimum_nights)) %>% 
  arrange(room_type, desc(count))

```


### Profit PER YEAR
```{r echo=FALSE}
student_df %>% 
  select(county, per_year_rent_AirBnB, available_nights) %>% 
  group_by(county , per_year_rent_AirBnB) %>% 
  summarise(count = n(),
            available_nights = sum(available_nights)) %>% 
  arrange(desc(count))

```
### Student Accomodation: Conclusion
There are a lot of AirBnB listings targetting students in Dublin, however, Cork City and Galways City charge students more for this service, based on average. One hosts has 216 listings that target student, ranging in location. It is unclear why this host does not advertise on Daft.ie as long-term student accomodation. Most of the listings that taget students are private rooms, with very slim amount are entire rental units. It is unclear of the size of these entire rental units and why the listing is not on Daft.ie. It has also been shown that it is more profitable to rent the properties, in all but 5 properties. It could be argued that these listings should be on daft.ie advertised to students, not on AirBnB for short-term lease.

## Homelessness
```{r echo=FALSE}
homeless_order <- homelessness_df %>% 
  select(homeless_county, number) %>% 
  arrange(desc(number))
```

### Homelessness by County or Region
```{r warning=FALSE, echo=FALSE}

xform <- list(categoryorder = "array",
              categoryarray = c(unique(homeless_order$homeless_county)),
              title = FALSE)

homeless_order %>%
  plot_ly(x = ~homeless_county, y = ~number, color = ~homeless_county,
          
          hovertemplate = ~paste("County:", homeless_county, "<br>", "Number of Homeless People:", number)) %>%
  add_bars(showlegend = FALSE) %>%
  layout(xaxis = xform,
          yaxis = list(title = "Number of Homeless People"))
```
**Comment:**
Above graph examines the number of homeless in each county or region, as reported by the government. Dublin has the highest number of homeless people than any other county or region. 

### AirBnB by County or Region
```{r warning=FALSE, echo=FALSE}
df %>%
  count(homeless_county, room_type) %>%
  mutate(homeless_county = fct_reorder(homeless_county, n, .desc = TRUE)) %>%
  plot_ly(x = ~homeless_county, y = ~n, color = ~room_type,
          
          hovertemplate = ~paste("County:", homeless_county, "<br>", "Number of AirBnB listings:", n)) %>%
  add_bars(showlegend = FALSE, colors = room_colors) %>%
  layout(xaxis = xform,
        yaxis = list(title = "Number of AirBnB listings"),
         barmode = 'stack',
         title = 'AirBnB listings by Room Type')
```
**Comment:**
When comparing AirBnB listing in the same county or region, it is clear that it is possible to place all homeless individuals into AirBnBs listings if these Listings became available for long-term lease.  

# Conclusion
There are concerns that AirBnB listings are reducing the supply of long-term leases in RPZs, which was shown to be true. The regulation that is being put forward by the government to dramatically decrease the number of AirBnB listings of entire rental units is very useful, however, this should also apply to  private rooms in RPZs, which can be used by college students and young professionals.  Entire rental units can be used by families or couples for long-term rent. Furthermore, it is unclear why the landlords choose to put their property on AirBnB when it has been showen that it is more profitable to rent the property when comparing potential AirBnB earning for the year (available nights * daily price) and potential annual rent earnings (rent per month * 12). 

As previously stated, a lot of listings were placed as long-term listings when the pandemic hit, hopefully reducing the pressure on the housing crisis. However, as we continue to come out of the pandemic, we should worry about the return of lack of accommodation in RPZs because of tourist season and increase in AirBnB listings. 

### Limitations
**Data** 
Although there were `r ncol(df)` columns of data in the final data, there are a few vital piece of information are missing. There are entire rental units (houses or apartments) that available for over 90 days of the year in Rent Pressurised Areas, which would require a planning permission. However, this poses a different question: 
- Why don't AirBnB hosts have their properties available all year around? 
- Why do AirBnB hosts choose to place their property on AirBnB and not do long-term leasing?
- Should the government create incentives for AirBnB hosts to lease their property for long-term? 
- Based on above question, perhaps, the government should review obstacles of long-term leasing. 

**Licence / Planning Permission**
After reading Data Dictionary provided AirBnB, it is unclear what is meant by column ‘licence’ in the AirBnB data.  Data analysis at the beginning showed that there are no values in column ‘licence’ and it was dropped from analysis. However, this raises concerns that it be referring to the planning permission required by the local authorities from hosts in RPZ. Lack of planning permissions from the local authorities should be examined. AirBnB should seek planning permissions from their hosts if they meet the criteria for planning permission.  

**Solving the Homelessness Issue in Ireland**
Although the homeless data was used as an example of using AirBnB listings as long-term rental units, it is still flawed. A fraction of homeless individuals have addiction or mental health issues, for which they seek support for in homeless charities such as Simon Community and Focus Ireland. These charities have specific housing for individuals who require extra support in their permanent homes. This would mean that simply placing them on their own into a house supplied from AirBnB would not solve the underlying issues but just place them into further isolation. 

However, it is clear that properties that are on AirBnB could have huge potential to reduce the pressure on the Housing Crisis.  Reduction of entire rental units and private rooms available on AirBnB could help to increase the number of properties available in RPZs for long-term rental for young families and students. This could reduce the rent for all residents in RPZ as more rental units are available and stabilise the rental markets.  

# References
Burke, C. (2021) *Rents continue to rise across Ireland as number of rental homes available hits ‘all-time low’, TheJournal.ie.* Available at: https://www.thejournal.ie/daft-rental-report-all-time-low-5596453-Nov2021/ (Accessed: 17 December 2021).

Burke-Kennedy, E. (2021) *Airbnb exodus increases stock of rental property in Dublin by 90%, The Irish Times.* Available at: https://www.irishtimes.com/business/economy/airbnb-exodus-increases-stock-of-rental-property-in-dublin-by-90-1.4654155 (Accessed: 17 December 2021).

Citizensinformation.ie (no date) *Renting your property for short-term lets.* Citizensinformation.ie. Available at: https://www.citizensinformation.ie/en/housing/owning_a_home/home_owners/renting_your_property_for_shortterm_lets.html (Accessed: 17 December 2021).

Department of Housing, Local Government and Heritage (2021) *Homeless Report - September 2021.* Available at: https://www.gov.ie/en/publication/0d7a7-homeless-report-september-2021/ (Accessed: 19 December 2021).

Lyons, R. (2021) *Irish Rental Report Q2 2021.* Available at: https://ww1.daft.ie/report/ronan-lyons-2021q2-daftrentalprice?d_rd=1 (Accessed: 17 December 2021).

McGrath, D. (2021) *Number of homeless people in Ireland rises for third month in a row – 8,212 adults and children now without home, Independent.* Available at: https://www.independent.ie/irish-news/number-of-homeless-people-in-ireland-rises-for-third-month-in-a-row-8212-adults-and-children-now-without-home-40885752.html (Accessed: 19 December 2021).

Pope, C. (2021) *New restrictions likely to reduce supply of short-term rental property, The Irish Times.* Available at: https://www.irishtimes.com/business/new-restrictions-likely-to-reduce-supply-of-short-term-rental-property-1.4653404 (Accessed: 17 December 2021).

Residential Tenancies Board (2021) *What are Rent Pressure Zones (RPZ)?* Available at: https://www.rtb.ie/during-a-tenancy/rent-review-in-a-rent-pressure-zone-rpz?gclid=Cj0KCQiAzfuNBhCGARIsAD1nu-8YhjJPsVbhgWjuM0et4lZX2ansT4b4XkLEEx9G63vDiVsptSzv8toaAkdDEALw_wcB (Accessed: 19 December 2021).
