
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=FALSE, warning=FALSE, message=FALSE}

library(tidyverse)
library(ggplot2)
library(dplyr)
library(stringr)
library(knitr)
library(plotly)
library(forcats)
library(crosstalk)
library(here)
library(camcorder)

```


```{R echo=FALSE, warning=FALSE, message=FALSE}
camcorder::gg_record(dir = here("outputs"),
  device = "png",
  width = 8, height = 7,
  units = "in", dpi = 320
  )
```


## Files submitted
- listings.csv - AirBnB listings in Ireland from the beginning of AirBnB operating in Ireland

- calendar.csv - AirBnB listings from 23rd October 2021 to 21st October 2021 (dates not chosen by student, supplied by AirBnB), contains 9 million rows.

- rent_pressure_zones.csv -RTZs (RPZs) were developed by the Irish government to tackle rising rents lack of affordable rental units. These are areas located in parts of the country where rents are the highest and rising, and where households have the greatest difficulty finding affordable accommodation (Residential Tenancies Board, 2021). The csv was manually created from RTB website. 

- rent_in_ireland.csv - The website daft.ie is the leading property website in Ireland, which publishes reports on the Irish housing market every quarter. For this next dataset, the report Q2 2021 was used to find out the rent in each city and county in Ireland (Lyons, 2021). The csv was manually created from the report. 


## Stage 1
Due to the 9 million rows in calendar.csv, it was decided to treat this dataset outside of this analysis due to the size of it. 

- calendar_df.Rmd - Code to treat calendar.csv and create the two datasets below to analyse in this report
- summarise_df.csv - A new dataset from calendar.csv  was created, where listings were examined by availability for each month within a year (23rd October 2021 to 21st October 2022).
- available_nights_df.csv - A new dataset summarising the number of available nights for each listing in a year (23rd October 2021 to 21st October 2022).
- calendar_df.html - Document presents calendar_df.Rmd in HTML

## Reading in the Airbnb Listings Data

```{r}

DIRECTORY = "data_2024"

# specifying the path to the CSV file
file_path <- here(DIRECTORY, "listings.csv")


# Read the CSV file
df <- read_csv(file_path)
```

In 'df' dataset, there are `r nrow(df) ` rows and `r ncol(df)` columns. Columns names are  `r colnames(df)`.

```{r}
#check the class of df
class(df)
```

```{r}
#check the column names for  df
colnames(df)
```

```{r}
# examining the structure in df
str(df)
```

```{r}
# examining the top 5 rows in df
head(df)
```

```{r}
# examining summary of all numeric columns in df
summary(df)
```


### Neighbourhood (renamed to 'lea')
Neighboourhood has some unclean data and 'LEA' was dropped from the values in the column. 

```{r echo=FALSE}
# declaring column as a factor
df$neighbourhood <- as.factor(df$neighbourhood)
df$neighbourhood_group <- as.factor(df$neighbourhood_group)
```

```{r results='hide', echo=FALSE}
# examining unique values in column 'neighbourhood'  
unique(df$neighbourhood)
```


```{r echo=FALSE}
# getting rid of LEA from the neighbourhood
df$neighbourhood <- str_replace(df$neighbourhood, '-7', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-6', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-5', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-4', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-3', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-3', '')
df$neighbourhood <- str_replace(df$neighbourhood, '-lea-7', ' LEA')
df$neighbourhood <- str_replace(df$neighbourhood, '-LEA', ' LEA')

# neighbourhood column is really 'lea'
df <- rename(df, lea=neighbourhood)

# declaring column as a factor
df$lea <- as.factor(df$lea)
```

```{r echo=FALSE}
# some values were still incorrect so they were manually changed
df$lea <- str_replace_all(df$lea, c('Graiguecullen -Portarlington LEA ' = 'Graiguecullen-Portarlington LEA',
                                    'Cavan - Belturbet LEA' = 'Cavan-Belturbet LEA',
                                    'Bandon - Kinsale LEA' ='Bandon-Kinsale LEA',
                                    'Bailieborough - Cootehill LEA' = 'Bailieborough-Cootehill LEA',
                                    'Laytown  Bettystown-lea' = 'Laytown-Bettystown LEA',
                                    'DÃºn Laoghaire LEA' = 'Dún Laoghaire-Rathdown County Council'))
```

```{r}
unique(df$lea)
```

### Neighbourhood Group (renamed to 'council')
```{r echo=FALSE}
# renaming neighbourhood_group to council because this is more accurate name
df<- rename(df, council = neighbourhood_group)

# declaring column as a factor
df$council <- as.factor(df$council)

# some values were still incorrect so they were manually changed
df$council <- str_replace(df$council, 'Dun Laoghaire-rathdown County Council', 'Dún Laoghaire-Rathdown County Council')
```

```{r}
# examining unique values in column 'council'  
unique(df$council)
```

### New Variable: County
A new variable 'county' was created from 'neighbourhood_group'. Several counties may have two or more county or city councils such as Cork, which has two councils: Cork City Council and Cork County Council. County Galway has two councils too: Galway City Council and Galway County Council.  Dublin has several councils: Fingal County Council, South Dublin County Council, Dún Laoghaire-Rathdown County Council, Dublin County Council. Some councils have two in one like Limerick City And County Council. To find out the county, string manipulation was conducted.

```{r echo=FALSE}
# getting rid of County Council from the council to assign county
df$county <- str_replace(df$council, ' County Council', '')
df$county <- str_replace(df$county, ' City Council', '')
df$county <- str_replace(df$county, ' City And', '')

# neighbourhood group in Dublin
df$county <- str_replace(df$county, 'Dún Laoghaire-Rathdown', 'Dublin')
df$county <- str_replace(df$county, 'Fingal', 'Dublin')
df$county <- str_replace(df$county, 'South Dublin', 'Dublin')

# assigning factor to country
df$county <- as.factor(df$county)
```

```{r}
unique(df$county)
```


### New Variable: 90-Day Threshold
Homeowners in RTZs (RPZs) are required to apply for planning permission if they let out their entire home (principal private residence) for short-term lets of more than 90 days in total while they are away. Principal private residence is the place where one ordinarily live (Citizensinformation.ie, no date).


A new variable 'threshold_day_90' was created to state whether the listing is 'under-90' or 'over-90' days. 
```{r echo=FALSE}
df <- df %>%  
  mutate(threshold_day_90 = if_else(availability_365 < 90, 'under-90', 'over-90'))

# assigning factor to threshold_day_90
df$threshold_day_90 <- as.factor(df$threshold_day_90)
```

```{r echo=FALSE}
# examining the count of threshold_day_90 
df %>% 
  select(threshold_day_90) %>% 
  group_by(threshold_day_90) %>% 
  summarise(count = n())
```

```{r}
head(df)
```

### Room Type
```{r echo=FALSE}
# personal preference 
df$room_type <- str_replace(df$room_type, 'Entire home/apt', 'Entire rental unit')
```

There are 4 room types: `r unique(df$room_type)`. However, hotels have planning permission with relevant authorities to host guests and lease rooms, therefore, hotels will be dropped from the data. Because of the small amount of shared rooms in the dataset, shared room were also dropped. 

```{r echo=FALSE}
df %>% 
  select(room_type) %>% 
  group_by(room_type) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```

```{r echo=FALSE}
# removing hotel
df <-  df %>% 
  filter(!(room_type == 'Hotel room' | room_type == 'Shared room')) 
```

```{r echo=FALSE}
# declaring column as a factor
df$room_type <- as.factor(df$room_type)
```


```{r}
# examining room type available in Room Type
unique(df$room_type)
```


### Dateset 'summarise_df'
Dateset 'summarise_df'  was created from 'calendar.csv', which was downloaded from the AirBnB website. It was downloaded from http://insideAirBnB.com/get-the-data.html (calendar.csv).  This dataset is between 23rd October 2021 to 21st October 2022. This dataset states whether the AirBnB listing is available on a specific date.

To examine how this dataset was created please see Rmd file called 'calendar_df.Rmd'

```{r}

DIRECTORY = "data_2024"

# specifying the path to the CSV file
file_path <- here(DIRECTORY, "summarise_df.csv")

# Read the CSV file
summarise_df <- read_csv(file_path)

```

In 'summarise_df' dataset, there are `r nrow(summarise_df)` rows and `r ncol(summarise_df)` columns in the dataset.
Columns names are  `r colnames(summarise_df)`.
```{r}
#check the class of summarise_df
class(summarise_df)
```

```{r}
#check the column names for  summarise_df
colnames(summarise_df)
```

```{r}
# examining the structure in summarise_df
str(summarise_df)
```

```{r}
# examining the top 5 rows in summarise_df
head(summarise_df)
```

```{r}
# examining summary of all numeric columns in summarise_df
summary(summarise_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| listing_id | integer | AirBnB's unique identifier for the listing |
| month | date | Month of the year |
| count | integer | Number of nights available in that month |
| min_price | integer | Minimum price for that listing in that month |
| mean_price | integer | Mean price for that listing in that month |
| max_price | integer | Maximum price for that listing in that month |

### Dateset 'available_nights_df' 
Dateset 'available_nights'  was created from 'calendar.csv', which was downloaded from the AirBnB website. It was downloaded from http://insideAirBnB.com/get-the-data.html (calendar.csv).  This dataset is between 23rd October 2021 to 21st October 2022. This dataset states whether the AirBnB listing is available on a specific date.

To examine how this dataset was created please see Rmd file called 'calendar_df.Rmd'

```{r}

# specifying the path to the CSV file
file_path <- here(DIRECTORY, "available_nights_df.csv")

# Read the CSV file
available_nights_df <- read_csv(file_path)

```

In 'available_nights_df' dataset, there are `r nrow(available_nights_df)` rows and `r ncol(available_nights_df)` columns in the dataset.
Columns names are  `r colnames(available_nights_df)`.
```{r}
#check the class of available_nights_df
class(available_nights_df)
```

```{r}
#check the column names for  available_nights_df
colnames(available_nights_df)
```

```{r}
# examining the structure in available_nights_df
str(available_nights_df)
```

```{r}
# examining the top 5 rows in available_nights_df
head(available_nights_df)
```

```{r}
# examining summary of all numeric columns in available_nights_df
summary(available_nights_df)
```


```{r}

total_nights_available = available_nights_df %>%
  group_by(listing_id) %>%
  summarise(total_nights_available = sum(count), 
            total_nights_available_price = mean_price)

total_nights_available
# 25,509 rows

```


```{r}
# Merging based on different column names
merged_df <- merge(df, total_nights_available, by.x = "id", by.y = "listing_id")
print(merged_df)

# 25,141 rows
```


```{r}
#  23,421 rows 
merged_df %>%
  select(availability_365, total_nights_available) %>%
  mutate(boolena = availability_365 == total_nights_available) %>%
  group_by(boolena) %>%
  summarise(n = n())

```



```{r}
#  23,421 rows 
merged_df %>%
  select(availability_365, total_nights_available) %>%
  mutate(boolena = availability_365 ==total_nights_available) %>%
  filter(boolena == FALSE)

```



```{r}
#  23,421 rows 
merged_df %>%
  select(price, total_nights_available_price) %>%
  mutate(boolena = price == total_nights_available_price) %>%
  group_by(boolena) %>%
  summarise(n = n())

```
```{r}
#  23,421 rows 
merged_df %>%
  select(price, total_nights_available_price) %>%
  mutate(boolena = total_nights_available_price ==price) %>%
  filter(boolena != TRUE)

```
```{r}
#  23,421 rows 
merged_df %>%
  select(id, availability_365, total_nights_available, price, total_nights_available_price) %>%
  mutate(boolena = total_nights_available_price ==price) %>%
  filter(is.na(boolena))

```


## Decision Time
```{r}
#  23,421 rows 

# Rename column A to B
df <- merged_df %>%
  select(-availability_365) %>%
  
  #235 rows 
  rename(availability_365 = total_nights_available) %>%
  
  # dealing with price combining
  mutate(
    price = case_when(
      is.na(price)~ total_nights_available_price,
  
      TRUE ~ price)) %>%
  select(-total_nights_available_price)  %>%
  
  # 62 rows have no price
  filter(!is.na(price)) 
  
```




### New Variable: airbnb_potential_annual_income
Creating a new variable 'airbnb_potential_annual_income', examining the full income potential of a listings by multiplying the price by the number of nights it is available for. 

```{r echo=FALSE}
df <- df %>%  
  select(everything()) %>%
  mutate(airbnb_potential_annual_income = price*availability_365)

```

```{r}
summary(df$airbnb_potential_annual_income)
```

```{r echo=FALSE}
df %>%
  plot_ly(x = ~airbnb_potential_annual_income) %>% 
  add_histogram() %>% 
  layout(xaxis = list(title = "Total Income"),
          yaxis = list(title = "Number of Observations"),
          title = "Histogram of Total Income")
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| listing_id | integer | AirBnB's unique identifier for the listing |
| available_nights | integer | Number of nights avaible during the year |

### Rent Pressure Zones
Rent Pressure Zones (RPZs) were developed by the Irish government to tackle rising rents lack of affordable rental units. These are areas located in parts of the country where rents are the highest and rising, and where households have the greatest difficulty finding affordable accommodation (Residential Tenancies Board, 2021). The csv was manually created from RTB website. 

```{r}

# specifying the path to the CSV file
file_path <- here(DIRECTORY, "rent_pressure_zones.csv")

# Read the CSV file
rpz_df <- read_csv(file_path, show_col_types = FALSE)


```

In 'rpz_df' dataset, there are `r nrow(rpz_df)` rows and `r ncol(rpz_df)` columns. Columns names are  `r colnames(rpz_df)`.
```{r}
#check the class of rpz_df
class(rpz_df)
```

```{r}
#check the column names for  rpz_df
colnames(rpz_df)
```

```{r}
# examining the structure in rpz_df
str(rpz_df)
```

```{r}
# examining the top 5 rows in rpz_df
head(rpz_df)
```

```{r}
# examining summary of all numeric columns in rpz_df
summary(rpz_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| neighbourhood | text | LEA or County Council e.g. Kildare County Council and Naas LEA |
| rpz | logical | Stating whether the area is in RTZs (RPZ): true or false |

### Rent Prices in Ireland
The website daft.ie is the leading property website in Ireland, which publishes reports on the Irish housing market every quarter. For this next dataset, the report Q2 2021 was used to find out the rent in each city and county in Ireland (Lyons, 2021). The csv was manually created from the report. 

```{r}

# specifying the path to the CSV file
file_path <- here(DIRECTORY, "rent_in_ireland.csv")

# Read the CSV file
rent_df <- read_csv(file_path)

```

In 'rent_df' dataset, here are `r nrow(rent_df)` rows and `r ncol(rent_df)` columns. Columns names are `r colnames(rent_df)`.
```{r}
#check the class of rent_df
class(rent_df)
```

```{r}
#check the column names for  rent_df
colnames(rent_df)
```

```{r}
# examining the structure in rent_df
str(rent_df)
```

```{r}
# examining the top 5 rows in rent_df
head(rent_df)
```

```{r}
# examining summary of all numeric columns in rent_df
summary(rent_df)
```

### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| county_city | text | County or City, e.g. County Galway and Galway City |
| rent_potential_annual_income_per_month | integer | Average price of a rental property in an area |





### Merging Datasets: 'df' with 'rent_df'
In 'df' dataset, a new column 'county_city' was created from 'council' to be the same as 'county_city' in 'rent_df'. 

```{r}
unique(rent_df$county_city)
```

```{r echo=FALSE, warning=FALSE}


# Applying case_when logic
df <- df %>%
  mutate(
    rent_council_city = case_when(
      lea == 'Tramore-Waterford City West LEA' ~ 'Waterford City',
      lea == 'Waterford City East LEA' ~ 'Waterford City',
      lea == 'Waterford City South LEA' ~ 'Waterford City',
      lea == 'Limerick City East LEA' ~ 'Limerick City',
      lea == 'Limerick City North LEA' ~ 'Limerick City',
      lea == 'Limerick City West LEA' ~ 'Limerick City',
      TRUE ~ council
    )
  )

unique(df$rent_council_city)

```

Datasets 'df' and 'rent_df' were merged on column 'county_city'.

```{r echo=FALSE}
# getting rid of County Council from the 'council' to assign county_city

df$rent_council_city <- str_replace(df$rent_council_city, ' Council', '')
df$rent_council_city <- str_replace(df$rent_council_city, ' City And County', ' County')

#### DUblin
df$rent_council_city <- str_replace(df$rent_council_city, 'Fingal County', ' Dublin City')
df$rent_council_city <- str_replace(df$rent_council_city, 'South Dublin County', ' Dublin City')

unique(df$rent_council_city)
```


```{r echo=FALSE}
# creating a new variable 'county_city' from 'county' to match 'county_city' in 'rent_df'  
# replacing strings 
df$rent_council_city <- str_replace_all(df$rent_council_city, c('Carlow County' = 'County Carlow',
                                                    'Dublin County' = 'Dublin City',
                                          'Galway County' = 'County Galway',
                                          'Cork County' = 'County Cork',
                                          'Waterford County' = 'County Waterford',
                                          'Offaly County' = 'County Offaly', 
                                          'Wicklow County' = 'County Wicklow', 
                                          'Tipperary County' = 'County Tipperary', 
                                          'Monaghan County' = 'County Monaghan', 
                                          'Sligo County' = 'County Sligo', 
                                          'Wexford County' = 'County Wexford', 
                                          'Clare County' = 'County Clare', 
                                          'Donegal County' = 'County Donegal', 
                                          'Meath County' = 'County Meath', 
                                          'Westmeath County' = 'County Westmeath', 
                                          'Mayo County' = 'County Mayo', 
                                          'Kildare County' = 'County Kildare',
                                          'Kerry County'= 'County Kerry',
                                          'Louth County' = 'County Louth',
                                          'Longford County' = 'County Longford',
                                          'Leitrim County' = 'County Leitrim',
                                          'Kilkenny County'= 'County Kilkenny',
                                          'Laois County'= 'County Laois',
                                          'Roscommon County'= 'County Roscommon',
                                          'Limerick County' = 'County Limerick',
                                          'Cavan County' = 'County Cavan'))



# assigning factor to county_city  variable
df$rent_council_city <- as.factor(df$rent_council_city)
```


```{r echo=FALSE}
# merging the dataset together
df<- merge(df, rent_df, by.x = "rent_council_city", by.y = "county_city")
```

```{r echo=FALSE}
# merging the dataset together
df %>%
  filter(is.na(rent_council_city))
```



### New Variable: Rent Per Day
Using rent_df (dataset with county or city and average rent), A new variable was calculated 'rent_potential_annual_income_per_day' which is the rent the tenant pays per day to stay in their rented property. Although this is not how this is not normally used in the renting market, this variable will be compared to the price of AirBnB, which is in 'per day'. It was decided to find the rent per day, because not all properties are leased for 365 days a year.

It was also assumed that private rooms will cost one third of an entire house to rent, i.e. if a house's rent is €1500, then a room to rent is €500. Although this is not the most accurate estimate, it is better than assuming that the price of a private room is the same as a rent of the whole house, i.e. €1500 for private room. This was also operated under the assumptions that all rooms in the house are the same size and have the same bathroom privileges, i.e. all en suite or all sharing.


```{r echo=FALSE}
# if the property is 'Entire rental unit'. then multiply rent_potential_annual_income_per_month by 12 (months) and divide by 365 (days)
# otherwise ('Private room' or 'Shared room') multiply rent_potential_annual_income_per_month by 12 (months), divide by 365 (days) and divide by 3 (rooms in the house)
df <- df %>%  
  mutate(rent_potential_annual_income_per_day = if_else(room_type == 'Entire rental unit', (rent_price_per_month*12)/365, ((rent_price_per_month*12)/365)/3))
```


```{r echo=FALSE}
# if the property is 'Entire rental unit'. then multiply rent_potential_annual_income_per_month by 12 (months) 
# otherwise ('Private room' or 'Shared room') multiply rent_potential_annual_income_per_month by 12 (months) and divide by 3 (rooms in the house)
df <- df %>%  
  mutate(rent_potential_annual_income = if_else(room_type == 'Entire rental unit', rent_price_per_month * 12, (rent_price_per_month*12)/3))
```




### New Variable: Rent or AirBnB?
New variable was created to examine whether the property should be rented or AirBnB listing.

Some thought was given to whether to compare AirBnB daily price and rent per day OR total income possible from AirBnB and total income from rent. Although comparing daily AirBnB and rent per day would allow to compare the income the landlord would get on per day, it does not show whether it is actually worth while listing the property on AirBnB bringings in more earnings than renting when taking in consideration the amount of nights that the property is available. Two varialbes were developed to examine this: per day and per year.  
If the AirBnB price is greater than price, then the property should be an AirBnB listing.
If the AirBnB price is lower than price, then the property should be rented.

```{r echo=FALSE}
# creating a new variable to state whether the property should be rented or on AirBnB
df <- df %>%  
  mutate(airbnb_potential_daily_income = if_else(price >= rent_potential_annual_income_per_day, 'AirBnB', 'Rent'))


# assigning factor to per_day_rent_AirBnB
df$airbnb_potential_daily_income <- as.factor(df$airbnb_potential_daily_income)
```

```{r echo=FALSE}
# examining the count of per_day_rent_AirBnB
df %>% 
  select(airbnb_potential_daily_income) %>% 
  group_by(airbnb_potential_daily_income) %>% 
  summarise(count = n())

```

``` {r echo=FALSE}
# creating a new variable to state whether the property should be rented or on AirBnB


df <- df %>%  
  select(everything()) %>%
  mutate(best_choice_airbnb_or_rent_per_year = if_else(airbnb_potential_annual_income >= rent_potential_annual_income, 'AirBnB', 'Rent'))

# assigning factor to best_choice_airbnb_or_rent_per_year
df$best_choice_airbnb_or_rent_per_year <- as.factor(df$best_choice_airbnb_or_rent_per_year)
```

```{r echo=FALSE}
# examining the count of per_day_rent_AirBnB
df %>% 
  select(best_choice_airbnb_or_rent_per_year) %>% 
  group_by(best_choice_airbnb_or_rent_per_year) %>% 
  summarise(count = n())

```

```{r echo=FALSE}
# examining the count of per_day_rent_AirBnB
df %>% 
  select(id, county,room_type, availability_365, price, airbnb_potential_annual_income, #rent_price_per_month, 
         rent_potential_annual_income, best_choice_airbnb_or_rent_per_year #,annual_diff_rent_minus_Airbnb
         )  %>%
  filter(is.na(best_choice_airbnb_or_rent_per_year))

```





### New Variable: Difference in Earnings - Long-Term or Airbnb - Numbers
```{r message=FALSE, echo=FALSE}
df <- df %>%
  mutate(annual_diff_rent_minus_Airbnb = airbnb_potential_annual_income -  rent_potential_annual_income)
```

### New Variable: RTZ

The column 'county_city' in 'rpz_df' had values which contained both values from columns 'council' and 'lea'. In this case, a new column had to be created stating whether the listing is a RTZ or not. 

```{r echo=FALSE}
unique(rpz_df$neighbourhood)
```

```{r echo=FALSE}
# Creating a new variable 
# Manually assessing whether it is TRUE or FALSE
# the list was taken from 'neighbourhood' in 'rpz_df' dataset
df <- df %>%  
  mutate(
    rent_pressure_zone = case_when(
      str_detect(council, 'Cork City Council') ~ TRUE,
      str_detect(council, 'Dublin City Council') ~ TRUE,
      str_detect(council, 'Dún Laoghaire-Rathdown County Council') ~ TRUE,
      str_detect(council, 'Fingal County Council') ~ TRUE,
      str_detect(council, 'South Dublin County Council') ~ TRUE,
      str_detect(council, 'Kildare County Council') ~ TRUE,
      str_detect(lea, 'Ballincollig–Carrigaline LEA') ~ TRUE,
      str_detect(lea, 'Galway City Central LEA') ~ TRUE,
      str_detect(lea, 'Galway City West LEA') ~ TRUE,
      str_detect(lea, 'Galway City East LEA') ~ TRUE,
      str_detect(lea, 'Drogheda LEA') ~ TRUE,
      str_detect(lea, 'Drogheda Urban LEA') ~ TRUE,
      str_detect(lea, 'Drogheda Rural LEA') ~ TRUE,
      str_detect(lea, 'Celbridge-Leixlip LEA') ~ TRUE,
      str_detect(lea, 'Naas LEA') ~ TRUE,
      str_detect(lea, 'Newbridge LEA') ~ TRUE,
      str_detect(lea, 'Ashbourne LEA') ~ TRUE,
      str_detect(lea, 'Laytown-Bettystown LEA') ~ TRUE,
      str_detect(lea, 'Ratoath LEA') ~ TRUE,
      str_detect(lea, 'Bray West LEA') ~ TRUE,
      str_detect(lea, 'Bray East LEA') ~ TRUE,
      str_detect(lea, 'Wicklow LEA') ~ TRUE,
      str_detect(lea, 'Cobh LEA') ~ TRUE,
      str_detect(lea, 'Maynooth LEA') ~ TRUE,
      str_detect(lea, 'Drogheda LEA') ~ TRUE,
      str_detect(lea, 'Greystones LEA') ~ TRUE,
      str_detect(lea, 'Limerick City East LEA') ~ TRUE,
      str_detect(lea, 'Navan LEA') ~ TRUE,
      str_detect(lea, 'Fermoy LEA') ~ TRUE,
      str_detect(lea, 'Midleton LEA') ~ TRUE,
      str_detect(lea, 'Athenry-Oranmore LEA') ~ TRUE,
      str_detect(lea, 'Gort-Kinvara LEA') ~ TRUE,
      str_detect(lea, 'Kilkenny LEA') ~ TRUE,
      str_detect(lea, 'Graiguecullen-Portarlington LEA') ~ TRUE,
      str_detect(lea, 'Portlaoise LEA') ~ TRUE,
      str_detect(lea, 'Limerick City North LEA') ~ TRUE,
      str_detect(lea, 'Limerick City West LEA') ~ TRUE,
      str_detect(lea, 'Ardee LEA') ~ TRUE,
      str_detect(lea, 'Dundalk-Carlingford LEA') ~ TRUE,
      str_detect(lea, 'Dundalk South LEA') ~ TRUE,
      str_detect(lea, 'Kells LEA') ~ TRUE,
      str_detect(lea, 'Trim LEA') ~ TRUE,
      str_detect(lea, 'Waterford City East LEA') ~ TRUE,
      str_detect(lea, 'Waterford City South LEA') ~ TRUE,
      str_detect(lea, 'Athlone LEA') ~ TRUE,
      str_detect(lea, 'Gorey LEA') ~ TRUE,
      str_detect(lea, 'Arklow LEA') ~ TRUE,
      str_detect(lea, 'Carlow LEA') ~ TRUE,
      str_detect(lea, 'Macroom LEA') ~ TRUE,
      str_detect(lea, 'Cobh LEA') ~ TRUE,
      str_detect(lea, 'Piltown LEA') ~ TRUE,
      str_detect(lea, 'Sligo-Strandhill LEA') ~ TRUE,
      str_detect(lea, 'Baltinglass LEA') ~ TRUE,
      str_detect(lea, 'Mallow LEA') ~ TRUE,
      str_detect(lea, 'Killarney LEA') ~ TRUE,
      str_detect(lea, 'Athy LEA') ~ TRUE,
      str_detect(lea, 'Tullamore LEA') ~ TRUE,
      str_detect(lea, 'Mullingar LEA') ~ TRUE,
      str_detect(lea, 'Bandon-Kinsale LEA') ~ TRUE,
      TRUE ~ FALSE)) 


# changing TRUE to 'RPZ' (RTZ) 
df$rent_pressure_zone <- str_replace(df$rent_pressure_zone, 'TRUE', 'RPZ')

# changing False to 'Non-RPZ' (Non RTZ) 
df$rent_pressure_zone <- str_replace(df$rent_pressure_zone, 'FALSE', 'Non-RPZ')

# assigning factor to rent_pressure_zone  variable
df$rent_pressure_zone <- as.factor(df$rent_pressure_zone)
```

```{r results='hide', echo=FALSE}
unique(df$rent_pressure_zone)
```

```{r echo=FALSE}
# examining the count of rent_pressure_zone TRUE or FALSE
df %>% 
  select(rent_pressure_zone) %>% 
  group_by(rent_pressure_zone) %>% 
  summarise(count = n())
```

### New Variable: Planning Permission
Creating a new variable 'planning_permission' in 'df' dataset to examine whether planning permission is required for the AirBnB listing. As stated above, an AirBnB listings of an entire property over 90 days in RTZ requires planning permission with the local authorites. New column will state whether planning permission is required or not. 
```{r echo=FALSE}
df <- df %>%  
  mutate(planning_permission = if_else((room_type == 'Entire rental unit' & threshold_day_90 == 'over-90' & rent_pressure_zone =='RPZ'), 'Planning Required', 'Not Required'))  
```


```{r echo=FALSE}
# examining the count of planning_permission 
df %>% 
  select(planning_permission) %>% 
  group_by(planning_permission) %>% 
  summarise(count = n())
```


### New Variable: Months Category
Creating a new variable 'planning_permission' in 'df' dataset to examine whether planning permission is required for the AirBnB listing. As stated above, an AirBnB listings of an entire property over 90 days in RTZ requires planning permission with the local authorites. New column will state whether planning permission is required or not. 
```{r echo=FALSE}
# Assuming sum_df is your dataset with availability_365 column
df <- df %>%
  mutate(month_category = case_when(
    availability_365 <= 30 ~ "1 month",
    availability_365 <= 61 ~ "2 months",
    availability_365 <= 91 ~ "3 months",
    availability_365 <= 122 ~ "4 months",
    availability_365 <= 152 ~ "5 months",
    availability_365 <= 183 ~ "6 months",
    availability_365 <= 213 ~ "7 months",
    availability_365 <= 244 ~ "8 months",
    availability_365 <= 274 ~ "9 months",
    availability_365 <= 305 ~ "10 months",
    availability_365 <= 335 ~ "11 months",
    availability_365 <= 365 ~ "12 months",
    TRUE ~ "More than 12 months"  # Covering cases beyond 1 year (365 days)
  ))


# changing  the order of factors
df$month_category <- factor(df$month_category, levels = c("1 month", 
                                                            "2 months",
                                                            "3 months",
                                                            "4 months",
                                                            "5 months",
                                                            "6 months",
                                                            "7 months",
                                                            "8 months",
                                                            "9 months",
                                                            "10 months",
                                                            "11 months",
                                                            "12 months",
                                                            "More than 12 months"
                                                            ))
# Print the first few rows to check
head(df)

```



After dropping the 'Hotel room' from the data, there are `r nrow(df) ` row in 'df' dataset.


### New Datasets: 'df' with 'summarise_df'
Dataset 'df' was merged with 'summarise_df' using 'listing_id' in 'available_nights_df' and 'id' in 'df'. 

```{r echo=FALSE}
# merging the dataset together
large_df<- merge(df, summarise_df, by.x = "id", by.y = "listing_id")
```

```{r}
names(large_df)
```


```{r echo=FALSE}
# dropping irrelevant columns
drop = c("id","host_id", "month", "count", "county", "room_type","term", 
         "availability_365", "county" ,                              
"rent_price_per_month" ,
"rent_potential_annual_income_per_day",
"rent_potential_annual_income",
"per_day_rent_AirBnB","best_choice_airbnb_or_rent_per_year",
"annual_diff_rent_minus_Airbnb","rent_pressure_zone", "threshold_day_90", "planning_permission", "month_category"                       
         
         )

large_df <- large_df[names(large_df) %in% drop] 
```

```{r}
names(df)
```

In the final 'large_df' dataset, there are `r nrow(large_df) ` rows and `r ncol(large_df)` columns. Columns names are  `r colnames(large_df)`. 

```{r echo=FALSE}
str(large_df)
```

```{r echo=FALSE}
nrow(large_df)
```

```{r echo=FALSE}
ncol(large_df)
```

```{r echo=FALSE}
head(large_df)
```




### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| id | integer | AirBnB's unique identifier for the listing |
| host_id | integer | Host's unique identifier |
| month | date | Month of the year |
| min_price | integer | Minimum price for that listing in that month |
| mean_price | integer | Mean price for that listing in that month |
| max_price | integer | Maximum price for that listing in that month |
| count | integer | Number of nights available in that month |
| county | text | County of AirBnB Listing |
| room_type | logical | Room type: Entire rental unit, Private room, Shared room |
| threshold_day_90 | text | Whether over-90 or under-90 days |
| term | text | Whether the AirBnB listing is available for long-term lease or short-term lease |
| per_day_rent_AirBnB  | text | Whether the property should be AirBnBed or rented our based on daily price |
| best_choice_airbnb_or_rent_per_year | text | Whether the property should be AirBnBed or rented our based on potential income |


# Final Dataset
In the final 'df' dataset, there are `r nrow(df) ` rows and `r ncol(df)` columns. Columns names are  `r colnames(df)`. 

Because our dataset was has been merged with 'available_nights_df', as described above, our dataset has AirBnB listings only available from 23rd October 2021 to 21st October 2022. Any past AirBnB are not included in our dataset. 

```{r echo=FALSE}
summary(df)
```

```{r echo=FALSE}
nrow(df)
```

```{r echo=FALSE}
ncol(df)
```
### Data Dictionary
| Field | Type  | Description |
|:-|:-|:-|
| id | integer | AirBnB's unique identifier for the listing |
| name | text | Title of the property on AirBnB |
| host_id | interger | AirBnB's unique identifier for the host |
| host_name | text | Host's name |
| lea | text | Local Electoral Areas (LEAs) |
| council | text | County or City Council  |
| county | text | County of the AirBnB Listing  |
| latitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| longitude | numeric | Uses the World Geodetic System (WGS84) projection for latitude and longitude |
| room_type | string | Entire rental unit, Private room, Shared room, Hotel room |
| price | currency | Daily price in local currency |


```{r echo=FALSE}
df %>%
  select(id, county,room_type, availability_365, price, airbnb_potential_annual_income, #rent_price_per_month, 
         rent_potential_annual_income, best_choice_airbnb_or_rent_per_year,annual_diff_rent_minus_Airbnb) 
```







```{r echo=FALSE}
# Define the file path using here
file_path <- here(DIRECTORY, "airbnb_final_df_20214.csv")

# Save the dataframe as a CSV file
write.csv(df, file = file_path, row.names = FALSE)

###################
# Define the file path using here
file_path <- here(DIRECTORY, "airbnb_large_df_2024.csv")
# Save the dataframe as a CSV file
write.csv(large_df, file = file_path)
```
 
## Data Sources

Lyons, R. (2021) *Irish Rental Report Q2 2021.* Available at: https://ww1.daft.ie/report/ronan-lyons-2021q2-daftrentalprice?d_rd=1 (Accessed: 17 December 2021).

Residential Tenancies Board (2021) *What are Rent Pressure Zones (RPZ)?* Available at: https://www.rtb.ie/during-a-tenancy/rent-review-in-a-rent-pressure-zone-rpz?gclid=Cj0KCQiAzfuNBhCGARIsAD1nu-8YhjJPsVbhgWjuM0et4lZX2ansT4b4XkLEEx9G63vDiVsptSzv8toaAkdDEALw_wcB (Accessed: 19 December 2021).


```{r}

```
